<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tomgs&#39;s blog</title>
  <meta name="author" content="tomgs">
  
  <meta name="description" content="Java学习">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Tomgs&#39;s blog"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="alternate" href="/atom.xml" title="Tomgs&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <!-- wumiiVerification -->
  <meta name="wumiiVerification" content="fb50a101-84fe-4ca2-91a7-ae8cf792978b" />
  <meta name="wumiiVerification" content="d73b5866-c390-4156-a4dd-51b526b5335e" />
  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!-- Font-Awesome -->
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">

</head>

<body>
  <header id="header"><div class= "header-content inner">
	<div class = "alignleft col-one">
		
			<div class='avatar'>
				<img src = "/img/default/avatar.jpg">
              </div>
		
		<div class="header-div">
		    <h1><a href="/">Tomgs&#39;s blog</a></h1>
		    <h2><a href="/">tomgsV5@gmail.com</a></h2>
		</div>
	</div>
	<div class = "alignright col-two">
		
	</div>
	<div class="clearfix"></div>
</div>

<div class= "header-nav">
	<div class='header-nav-content inner'>
		<div id="main-nav" class="alignleft">
		    		
		    		  <a href="/"><i class="fa fa-home"></i>首页</a>
		    		
		    		  <a href="/archives"><i class="fa fa-archive"></i>归档</a>
		    		
		    		  <a href="/categories/java"><i class="fa fa-book"></i>电子书</a>
		    		
		</div>
		<div id="sub-nav" class="alignright">
		    
		      <a href="/about"><i class="fa fa-user"></i>关于我</a>
		    
		</div>
	</div>
	<div class="clearfix"></div>
</div>
</header>
  
    <div id="content" class="inner">
      <div id="main-col" class="alignleft"><div id="wrapper">
    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2018-04-06T03:02:17.000Z"><a href="/2018/04/06/AB压测工具使用/">2018-04-06</a></time>
        
  
    <h1 class="title"><a href="/2018/04/06/AB压测工具使用/">AB压测工具使用</a></h1>
  

    </header>

    <div class="entry">
      
        <h1 id="AB压测工具的使用"><a href="#AB压测工具的使用" class="headerlink" title="AB压测工具的使用"></a>AB压测工具的使用</h1><p>官网：<br><br><a href="http://mirror.bit.edu.cn/apache/httpd/" target="_blank" rel="noopener">http://mirror.bit.edu.cn/apache/httpd/</a><br><br><a href="http://httpd.apache.org/docs/2.4/programs/ab.html" target="_blank" rel="noopener">http://httpd.apache.org/docs/2.4/programs/ab.html</a><br><br><a href="http://httpd.apache.org/docs/2.2/" target="_blank" rel="noopener">http://httpd.apache.org/docs/2.2/</a><br></p>
<h1 id="什么是AB"><a href="#什么是AB" class="headerlink" title="什么是AB"></a>什么是AB</h1><p>它是Apache服务器的一个命令，ab命令模拟多线程并发请求，测试服务器负载压力，也可以测试nginx、lighthttp、IIS等其它Web服务器的压力。<br>ab命令对发出负载的计算机要求很低，既不会占用很多CPU，也不会占用太多的内存，但却会给目标服务器造成巨大的负载，因此是某些DDOS攻击之必备良药，老少皆宜。自己使用也须谨慎。否则压测负载过多，造成目标服务器直接因内存耗光死机，而不得不硬重启，得不偿失。<br>在带宽不足的情况下，最好是本机进行测试，建议使用内网的另一台或者多台服务器通过内网进行测试，这样得出的数据，准确度会高很多。远程对web服务器进行压力测试，往往效果不理想（因为网络延时过大或带宽不足）<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2018/04/06/AB压测工具使用/#more" class="more-link">Read More</a>
          </div>
        
        
        <div class="alignright">
          <a href="/2018/04/06/AB压测工具使用/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2018-03-15T15:56:51.000Z"><a href="/2018/03/15/JVM工具/">2018-03-15</a></time>
        
  
    <h1 class="title"><a href="/2018/03/15/JVM工具/">JVM工具</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#jps"><span class="toc-text">jps</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#用法"><span class="toc-text">用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参数"><span class="toc-text">参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例："><span class="toc-text">示例：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jinfo"><span class="toc-text">jinfo</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#用法："><span class="toc-text">用法：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参数："><span class="toc-text">参数：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#选项："><span class="toc-text">选项：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例：-1"><span class="toc-text">示例：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jstack"><span class="toc-text">jstack</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#用法-1"><span class="toc-text">用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#选项"><span class="toc-text">选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例"><span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jstat"><span class="toc-text">jstat</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#用法-2"><span class="toc-text">用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#选项-1"><span class="toc-text">选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#option"><span class="toc-text">option</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例-1"><span class="toc-text">示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gc"><span class="toc-text">-gc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gcutil"><span class="toc-text">-gcutil</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gcnew"><span class="toc-text">-gcnew</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jmap"><span class="toc-text">jmap</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#用法-3"><span class="toc-text">用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#选项说明"><span class="toc-text">选项说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例-2"><span class="toc-text">示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#heap"><span class="toc-text">heap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#histo-live"><span class="toc-text">histo[:live]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#permstat"><span class="toc-text">permstat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dump"><span class="toc-text">dump</span></a></li></ol></li></ol></li></ol>
    </div>

        <h1 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h1><p>JPS 查看当前运行java进程<br>JVM Process Status Tool,显示指定系统内所有的HotSpot虚拟机进程。</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jps -lvm 用于查看当前机器上运行的java进程。 </span><br><span class="line"></span><br><span class="line">命令格式 jps [options] [hostid] </span><br><span class="line">注：如果不指定hostid就默认为当前主机或服务器。</span><br></pre></td></tr></table></figure>
<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><blockquote>
<p>常用命令行参数选项说明如下： <br><br>-q &nbsp;不输出类名、Jar名和传入main方法的参数 <br><br>-m 输出传入main方法的参数 <br><br>-l &nbsp;&nbsp;输出main类或Jar的全限名 <br><br>-v &nbsp;输出传入JVM的参数<br><br>-V 输出通过标记的文件传递给JVM的参数（.hotspotrc文件，或者是通过参数-XX:Flags=指定的文件）。<br><br>-J 用于传递jvm选项到由javac调用的java加载器中，例如，“-J-Xms48m”将把启动内存设置为48M，使用-J选项可以非常方便的向基于Java的开发的底层虚拟机应用程序传递参数。</p>
</blockquote>
<p>jps有问题, 使用 jps -J-Djps.debug=true -J-Djps.printStackTrace=true 可以获得Jps错误详细信息</p>
<h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><p>jps -lvm<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;jps -lvm</span><br><span class="line">6116 org.apache.catalina.startup.Bootstrap start -agentlib:jdwp=transport=dt_socket,suspend=y,address=localhost:63138 -Djava.net.preferIPv4Stack=true -Dcatalina.base=E:\apache-tomcat-7.0.65 -Dcatalina.home=E:\apache-tomcat-7.0.65 -Dwtp.deploy=E:\apache-tomcat-7.0.65\me-webapps -Djava.endorsed.dirs=E:\apache-tomcat-7.0.65\endorsed -Dfile.encoding=UTF-8</span><br><span class="line">6000 sun.tools.jps.Jps -lvm -Denv.class.path=.;D:\apps\Java\jdk1.7\bin;D:\apps\Java\jdk1.7\lib\dt.jar;D:\apps\Java\jdk1.7\lib\tools.jar -Dapplication.home=D:\apps\Java\jdk1.7 -Xms8m</span><br><span class="line">12892 C:\Users\tomgs\AppData\Local\Temp\pul9953.tmp\PULSEI~1.JAR -os win32 -ws win32 -arch x86_64 -showsplash -launcher D:\apps\MyEclipse 2015 CI\myeclipse.exe -name Myeclipse --launcher.library D:\apps\MyEclipse 2015 CI\plugins/org.eclipse.equinox.launcher.i18n.win32.win32.x86_64_3.2.0.v201103301700\eclipse_3215.dll -startup D:\apps\MyEclipse 2015 CI\plugins/org.eclipse.equinox.launcher_1.3.0.v20140415-2008.jar -exitdata 8ac_f4 -install D:\apps\MyEclipse 2015 CI -vm D:\apps\MyEclipse 2015 CI\binary/com.sun.java.jdk7.win32.x86_64_1.7.0.u45/bin/javaw.exe -vmargs -Xmx2048m -Xms512m -XX:PermSize=256m -XX:MaxPermSize=512m -XX:ReservedCodeCacheSize=128m -Dosgi.nls.warnings=ignore -Dfile.encoding=UTF-8 -jar C:\Users\tomgs\AppData\Local\Temp\pul9953.tmp\PULSEI~1.JAR -Xmx2048m -Xms512m -XX:PermSize=256m -XX:MaxPermSize=512m -XX:ReservedCodeCacheSize=128m -Dosgi.nls.warnings=ignore -Dfile.encoding=UTF-8</span><br></pre></td></tr></table></figure></p>
<p>jps -l<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;jps -l</span><br><span class="line">6116 org.apache.catalina.startup.Bootstrap</span><br><span class="line">12124 sun.tools.jps.Jps</span><br><span class="line">12892 C:\Users\tomgs\AppData\Local\Temp\pul9953.tmp\PULSEI~1.JAR</span><br></pre></td></tr></table></figure></p>
<p>jps -V<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;jps -V</span><br><span class="line">13108 Jps</span><br><span class="line">6116 Bootstrap</span><br><span class="line">12892 PULSEI~1.JAR</span><br></pre></td></tr></table></figure></p>
<h1 id="jinfo"><a href="#jinfo" class="headerlink" title="jinfo"></a>jinfo</h1><p>该命令可以打印出java进程的配置信息：包括jvm参数，系统属性等</p>
<h2 id="用法："><a href="#用法：" class="headerlink" title="用法："></a>用法：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jinfo [ option ] pid</span><br><span class="line">jinfo [ option ] executable core</span><br><span class="line">jinfo [ option ] [server-id@]remote-hostname-or-IP</span><br></pre></td></tr></table></figure>
<h2 id="参数："><a href="#参数：" class="headerlink" title="参数："></a>参数：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pid   进程号</span><br><span class="line">executable   产生core dump的java executable</span><br><span class="line">core   core file</span><br><span class="line">remote-hostname-or-IP  主机名或ip</span><br><span class="line">server-id    远程主机上的debug server的唯一id</span><br></pre></td></tr></table></figure>
<h2 id="选项："><a href="#选项：" class="headerlink" title="选项："></a>选项：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">no option  打印命令行参数和系统属性</span><br><span class="line">-flags  打印命令行参数</span><br><span class="line">-sysprops  打印系统属性</span><br><span class="line">-h  帮助</span><br></pre></td></tr></table></figure>
<h2 id="示例：-1"><a href="#示例：-1" class="headerlink" title="示例："></a>示例：</h2><p>jinfo pid<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;jinfo 6116</span><br><span class="line">Attaching to process ID 6116, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 24.79-b02</span><br><span class="line">Java System Properties:</span><br><span class="line"></span><br><span class="line">java.vendor = Oracle Corporation</span><br><span class="line">sun.java.launcher = SUN_STANDARD</span><br><span class="line">catalina.base = E:\apache-tomcat-7.0.65</span><br><span class="line">sun.management.compiler = HotSpot 64-Bit Tiered Compilers</span><br><span class="line">catalina.useNaming = true</span><br><span class="line">os.name = Windows 8.1</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">wtp.deploy = E:\apache-tomcat-7.0.65\me-webapps</span><br><span class="line">PAYMENT_LOG_PATH = E:\apache-tomcat-7.0.65\me-webapps\z_test_payment-gateway\logs</span><br><span class="line">java.vm.name = Java HotSpot(TM) 64-Bit Server VM</span><br><span class="line">file.encoding = UTF-8</span><br><span class="line">java.specification.version = 1.7</span><br><span class="line"></span><br><span class="line">VM Flags: //JVM参数</span><br><span class="line"></span><br><span class="line">-agentlib:jdwp=transport=dt_socket,suspend=y,address=localhost:63138 -Djava.net.preferIPv4Stack=true -Dcatalina.base=E:\apache-tomcat-7.0.65 -Dcatalina.home=E:\apache-tomcat-7.0.65 -Dwtp.deploy=E:\apache-tomcat-7.0.65\me-webapps -Djava.endorsed.dirs=E:\apache-tomcat-7.0.65\endorsed -Dfile.encoding=UTF-8</span><br></pre></td></tr></table></figure></p>
<p>jinfo -flags pid<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;jinfo -flags 6116</span><br><span class="line">Attaching to process ID 6116, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 24.79-b02</span><br><span class="line"></span><br><span class="line">-agentlib:jdwp=transport=dt_socket,suspend=y,address=localhost:63138 -Djava.net.preferIPv4Stack=true -Dcatalina.base=E:\apache-tomcat-7.0.65 -Dcatalina.home=E:\apache-tomcat-7.0.65 -Dwtp.deploy=E:\apache-tomcat-7.0.65\me-webapps -Djava.endorsed.dirs=E:\apache-tomcat-7.0.65\endorsed -Dfile.encoding=UTF-8</span><br></pre></td></tr></table></figure></p>
<h1 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h1><p>打印线程信息</p>
<h2 id="用法-1"><a href="#用法-1" class="headerlink" title="用法"></a>用法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack [ option ] pid</span><br></pre></td></tr></table></figure>
<h2 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-l 打印锁信息</span><br><span class="line">-m 打印java和native的帧信息</span><br><span class="line">-F 强制dump，当jstack没有响应时使用</span><br></pre></td></tr></table></figure>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>将线程pid为120的线程dump到c盘的a.txt文件中<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack 1200 &gt;&gt; C:\a.txt</span><br></pre></td></tr></table></figure></p>
<p>分析另起文章说明。</p>
<h1 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h1><p>jstat(JVM statistics Monitoring)是用于监视虚拟机运行时状态信息的命令，它可以显示出虚拟机进程中的类装载、内存、垃圾收集、JIT编译等运行数据。</p>
<p>详细请见官方文档介绍：<a href="https://docs.oracle.com/javase/7/docs/technotes/tools/share/jstat.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/7/docs/technotes/tools/share/jstat.html</a></p>
<h2 id="用法-2"><a href="#用法-2" class="headerlink" title="用法"></a>用法</h2><pre><code>jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]
</code></pre><h2 id="选项-1"><a href="#选项-1" class="headerlink" title="选项"></a>选项</h2><blockquote>
<p>option - 选项，我们一般使用 -gcutil 查看gc情况</p>
<p>vmid - VM的进程号，即当前运行的java进程号</p>
<p>interval - 间隔时间，单位为秒或者毫秒</p>
<p>count - 打印次数，如果缺省则打印无数次</p>
</blockquote>
<h3 id="option"><a href="#option" class="headerlink" title="option"></a>option</h3><table>
<thead>
<tr>
<th>Option</th>
<th>Displays</th>
</tr>
</thead>
<tbody>
<tr>
<td>class</td>
<td>Statistics on the behavior of the class loader.</td>
</tr>
<tr>
<td>compiler</td>
<td>Statistics of the behavior of the HotSpot Just-in-Time compiler.</td>
</tr>
<tr>
<td><strong><em>gc</em></strong></td>
<td>Statistics of the behavior of the garbage collected heap.</td>
</tr>
<tr>
<td><strong><em>gccapacity</em></strong></td>
<td>Statistics of the capacities of the generations</td>
<td>and their corresponding spaces.</td>
</tr>
<tr>
<td>gccause</td>
<td>Summary of garbage collection statistics (same as -gcutil), with the cause of the last and current</td>
<td>(if applicable) garbage collection events.</td>
</tr>
<tr>
<td><strong><em>gcnew</em></strong></td>
<td>Statistics of the behavior of the new generation.</td>
</tr>
<tr>
<td>gcnewcapacity</td>
<td>Statistics of the sizes of the new generations</td>
<td>and its corresponding spaces.</td>
</tr>
<tr>
<td><strong><em>gcold</em></strong></td>
<td>Statistics of the behavior of the old and permanent generations.</td>
</tr>
<tr>
<td>gcoldcapacity</td>
<td>Statistics of the sizes of the old generation.</td>
</tr>
<tr>
<td>gcpermcapacity</td>
<td>Statistics of the sizes of the permanent generation.</td>
</tr>
<tr>
<td><strong><em>gcutil</em></strong></td>
<td>Summary of garbage collection statistics.</td>
</tr>
<tr>
<td>printcompilation</td>
<td>HotSpot compilation method statistics.</td>
</tr>
</tbody>
</table>
<h2 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h2><h3 id="gc"><a href="#gc" class="headerlink" title="-gc"></a>-gc</h3><pre><code>jstat -gc pid [interval] [count]
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;jstat -gc 12760</span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       PC     PU    YGC     YGCT    FGC    FGCT     GCT  </span><br><span class="line">512.0  512.0   0.0   184.4   3072.0   1438.0    7168.0     605.4    21504.0 2572.2    121    0.163   0      0.000    0.163</span><br><span class="line"></span><br><span class="line">C:\Users\tomgs&gt;jstat -gc 12760 250 6</span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       PC     PU    YGC     YGCT    FGC    FGCT     GCT  </span><br><span class="line">512.0  512.0  208.3   0.0    3072.0   1262.1    7168.0     605.4    21504.0 2572.5    166    0.229   0      0.000    0.229</span><br><span class="line">512.0  512.0   0.0   256.0   3072.0   2376.6    7168.0     605.4    21504.0 2572.5    167    0.231   0      0.000    0.231</span><br><span class="line">512.0  512.0   0.0   240.3   3072.0    0.0      7168.0     605.4    21504.0 2572.5    169    0.233   0      0.000    0.233</span><br><span class="line">512.0  512.0  192.0   0.0    3072.0   315.4     7168.0     605.4    21504.0 2572.5    170    0.234   0      0.000    0.234</span><br><span class="line">512.0  512.0   0.0   240.3   3072.0   1689.4    7168.0     605.4    21504.0 2572.7    171    0.236   0      0.000    0.236</span><br><span class="line">512.0  512.0   0.0   160.0   3072.0    0.0      7168.0     605.4    21504.0 2572.7    173    0.238   0      0.000    0.238</span><br></pre></td></tr></table></figure>
<p>说明：</p>
<blockquote>
<p>C 即Capacity 总容量，U 即Used 已使用的容量 <br><br>S0C : survivor0区的总容量 <br><br>S1C : survivor1区的总容量 <br><br>S0U : survivor0区已使用的容量 <br><br>S1C : survivor1区已使用的容量 <br><br>EC : Eden区的总容量 <br><br>EU : Eden区已使用的容量 <br><br>OC : Old区的总容量 <br><br>OU : Old区已使用的容量 <br><br>MC ：方法区大小 <br><br>MU ：方法区使用大小 <br><br>CCSC : 压缩类空间大小 <br><br>CCSU : 压缩类空间使用大小 <br><br>YGC : 新生代垃圾回收次数 <br><br>YGCT : 新生代垃圾回收时间 <br><br>FGC : 老年代垃圾回收次数 <br><br>FGCT : 老年代垃圾回收时间 <br><br>GCT : 垃圾回收总消耗时间 <br></p>
</blockquote>
<h3 id="gcutil"><a href="#gcutil" class="headerlink" title="-gcutil"></a>-gcutil</h3><pre><code>jstat -gcutil pid [interval] [count]
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcutil 21891 250 7</span><br><span class="line">  </span><br><span class="line">  S0     S1     E      O      P     YGC    YGCT    FGC    FGCT     GCT</span><br><span class="line"></span><br><span class="line"> 12.44   0.00  27.20   9.49  96.70    78    0.176     5    0.495    0.672</span><br><span class="line"></span><br><span class="line"> 12.44   0.00  62.16   9.49  96.70    78    0.176     5    0.495    0.672</span><br><span class="line"></span><br><span class="line"> 12.44   0.00  83.97   9.49  96.70    78    0.176     5    0.495    0.672</span><br><span class="line"></span><br><span class="line">  0.00   7.74   0.00   9.51  96.70    79    0.177     5    0.495    0.673</span><br><span class="line"></span><br><span class="line">  0.00   7.74  23.37   9.51  96.70    79    0.177     5    0.495    0.673</span><br><span class="line"></span><br><span class="line">  0.00   7.74  43.82   9.51  96.70    79    0.177     5    0.495    0.673</span><br><span class="line"></span><br><span class="line">  0.00   7.74  58.11   9.51  96.71    79    0.177     5    0.495    0.673</span><br></pre></td></tr></table></figure>
<p>The output of this example shows that a young generation collection occurred between the 3rd and 4th sample. The collection took 0.001 seconds and promoted objects from the eden space (E) to the old space (O), resulting in an increase of old space utilization from 9.49% to 9.51%. Before the collection, the survivor space was 12.44% utilized, but after this collection it is only 7.74% utilized.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>S0</td>
<td>Survivor space 0 utilization as a percentage of the space’s current capacity.</td>
</tr>
<tr>
<td>S1</td>
<td>Survivor space 1 utilization as a percentage of the space’s current capacity.</td>
</tr>
<tr>
<td>E</td>
<td>Eden space utilization as a percentage of the space’s current capacity.</td>
</tr>
<tr>
<td>O</td>
<td>Old space utilization as a percentage of the space’s current capacity.</td>
</tr>
<tr>
<td>P</td>
<td>Permanent space utilization as a percentage of the space’s current capacity.</td>
</tr>
<tr>
<td>YGC</td>
<td>Number of young generation GC events.</td>
</tr>
<tr>
<td>YGCT</td>
<td>Young generation garbage collection time.</td>
</tr>
</tbody>
</table>
<p>FGC    Number of full GC events.<br>FGCT    | Full garbage collection time.<br>GCT    | Total garbage collection time.</p>
<h3 id="gcnew"><a href="#gcnew" class="headerlink" title="-gcnew"></a>-gcnew</h3><pre><code>jstat -gcnew [outputOptions] pid [interval]
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcnew -h3 21891 250</span><br><span class="line"></span><br><span class="line">S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT</span><br><span class="line"></span><br><span class="line"> 64.0   64.0    0.0   31.7 31  31   32.0    512.0    178.6    249    0.203</span><br><span class="line"></span><br><span class="line"> 64.0   64.0    0.0   31.7 31  31   32.0    512.0    355.5    249    0.203</span><br><span class="line"></span><br><span class="line"> 64.0   64.0   35.4    0.0  2  31   32.0    512.0     21.9    250    0.204</span><br><span class="line"></span><br><span class="line">S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT</span><br><span class="line"></span><br><span class="line"> 64.0   64.0   35.4    0.0  2  31   32.0    512.0    245.9    250    0.204</span><br><span class="line"></span><br><span class="line"> 64.0   64.0   35.4    0.0  2  31   32.0    512.0    421.1    250    0.204</span><br><span class="line"></span><br><span class="line"> 64.0   64.0    0.0   19.0 31  31   32.0    512.0     84.4    251    0.204</span><br><span class="line"></span><br><span class="line">S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT</span><br><span class="line"></span><br><span class="line"> 64.0   64.0    0.0   19.0 31  31   32.0    512.0    306.7    251    0.204</span><br></pre></td></tr></table></figure>
<p>In addition to showing the repeating header string, this example shows that between the 2nd and 3rd samples, a young GC occurred. Its duration was 0.001 seconds. The collection found enough live data that the survivor space 0 utilization (S0U) would would have exceeded the desired survivor Size (DSS). As a result, objects were promoted to the old generation (not visible in this output), and the tenuring threshold (TT) was lowered from 31 to 2.</p>
<p>Another collection occurs between the 5th and 6th samples. This collection found very few survivors and returned the tenuring threshold to 31.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>S0C</td>
<td>Current survivor space 0 capacity (KB).</td>
</tr>
<tr>
<td>S1C</td>
<td>Current survivor space 1 capacity (KB).</td>
</tr>
<tr>
<td>S0U</td>
<td>Survivor space 0 utilization(利用，使用) (KB).</td>
</tr>
<tr>
<td>S1U</td>
<td>Survivor space 1 utilization (KB).</td>
</tr>
<tr>
<td>TT</td>
<td>Tenuring threshold(门槛).</td>
</tr>
<tr>
<td>MTT</td>
<td>Maximum tenuring threshold.</td>
</tr>
<tr>
<td>DSS</td>
<td>Desired(期望) survivor size (KB).</td>
</tr>
<tr>
<td>EC</td>
<td>Current eden space capacity (KB).</td>
</tr>
<tr>
<td>EU</td>
<td>Eden space utilization (KB).</td>
</tr>
<tr>
<td>YGC</td>
<td>Number of young generation GC events.</td>
</tr>
<tr>
<td>YGCT</td>
<td>Young generation garbage collection time.</td>
</tr>
</tbody>
</table>
<blockquote>
<p>什么情况下新生代对象会晋升到老年代？</p>
<ol>
<li>当对象大小超过了PretenureSizeThreshold设置的对象大小阀值时，对象直接在老年代分配空间。</li>
<li>当age从1开始的对象大小累计超过了Survivor区域的1/2(TargetSurvivorRatio所定义)时，会计算一个Thenuring Threshold，超过这个年龄的新生代对象会进入到老年代，即使这时候新生代还有很多的空间。注意MaxTenuringThreshold只是设置了最大的Thenuring Threshold，不是说只有大于Max Tenuring Threshold才会进入到老年代，而是只要超过了计算出来的Tenuring Threshold就会进入老年代，MaxTenuringThreshold规定了Tenuring Threshold的最大值而已。Tenuring Threshold这个值在每一轮GC后都会动态计算，它与TargetSurvivorRatio以及Survivor区的大小有关系，TargetSurivivor默认是50即Survivor的1/2, 会计算出一个Desired Survivor Size，当age从1开始的对象大小累计超过了这个Desired Survivor Size，那么这个age就是Tenuring Threshold的值。</li>
</ol>
</blockquote>
<h1 id="jmap"><a href="#jmap" class="headerlink" title="jmap"></a>jmap</h1><p>JVM Memory Map命令用于生成heap dump文件，如果不使用这个命令，还可以使用-XX:+HeapDumpOnOutOfMemoryError参数来让虚拟机出现OOM的时候自动生成dump文件。 jmap不仅能生成dump文件，还可以查询finalize执行队列、Java堆和永久代的详细信息，如当前使用率、当前使用的是哪种收集器等。</p>
<p>jmap命令官方文档：<a href="https://docs.oracle.com/javase/6/docs/technotes/tools/share/jmap.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/6/docs/technotes/tools/share/jmap.html</a></p>
<h2 id="用法-3"><a href="#用法-3" class="headerlink" title="用法"></a>用法</h2><pre><code>jmap [option] pid
</code></pre><blockquote>
<p>具体说明可以使用 <code>jmap -help</code> 查看</p>
</blockquote>
<h2 id="选项说明"><a href="#选项说明" class="headerlink" title="选项说明"></a>选项说明</h2><blockquote>
<p><code>-dump:[live,]format=b,file=&lt;filename&gt;</code> : Dumps the Java heap in hprof binary format to filename. The live suboption is optional. If specified, only the live objects in the heap are dumped. To browse the heap dump, you can use jhat (Java Heap Analysis Tool) to read the generated file. <br></p>
<p><code>-finalizerinfo</code> : 显示在F-Queue队列等待Finalizer线程执行finalizer方法的对象 <br></p>
<p><code>-heap</code> : 显示Java堆详细信息 <br></p>
<p><code>-histo[:live]</code> : 显示堆中对象的统计信息，如果指定了<code>live</code>子选项，则只计数活动对象。 <br></p>
<p><code>-permstat</code> : to print permanent generation statistics <br></p>
<p><code>-F</code> : 当-dump没有响应时，强制生成dump快照 <br></p>
<p><code>-J&lt;flag&gt;</code> :<br>Passes <flag> to the Java virtual machine on which jmap is run</flag></p>
</blockquote>
<h2 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h2><h3 id="heap"><a href="#heap" class="headerlink" title="heap"></a>heap</h3><p>先用<code>jps</code>找出相关Java线程的pid，然后使用此命令。</p>
<pre><code>$ jmap -heap pid
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;jmap -heap 13812</span><br><span class="line">Attaching to process ID 13812, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 24.79-b02</span><br><span class="line"></span><br><span class="line">using thread-local object allocation.</span><br><span class="line">Parallel GC with 8 thread(s) //GC 方式</span><br><span class="line"></span><br><span class="line">Heap Configuration: //堆内存初始化配置</span><br><span class="line">   MinHeapFreeRatio         = 0//对应jvm启动参数-XX:MinHeapFreeRatio设置JVM堆最小空闲比率(default 40)</span><br><span class="line">   MaxHeapFreeRatio         = 100//对应jvm启动参数 -XX:MaxHeapFreeRatio设置JVM堆最大空闲比率(default 70)</span><br><span class="line">   MaxHeapSize              = 1040187392 (992.0MB) //对应jvm启动参数-XX:MaxHeapSize=设置JVM堆的最大大小</span><br><span class="line">   NewSize                  = 21495808 (20.5MB)//对应jvm启动参数-XX:NewSize=设置JVM堆的‘新生代’的默认大小</span><br><span class="line">   MaxNewSize               = 346554368 (330.5MB)//对应jvm启动参数-XX:MaxNewSize=设置JVM堆的‘新生代’的最大大小</span><br><span class="line">   OldSize                  = 43515904 (41.5MB)//对应jvm启动参数-XX:OldSize=&lt;value&gt;:设置JVM堆的‘老生代’的大小</span><br><span class="line">   NewRatio                 = 2//对应jvm启动参数-XX:NewRatio=:‘新生代’和‘老生代’的大小比率</span><br><span class="line">   SurvivorRatio            = 8//对应jvm启动参数-XX:SurvivorRatio=设置年轻代中Eden区与Survivor区的大小比值 </span><br><span class="line"></span><br><span class="line">   PermSize         = 21757952 (20.75MB)</span><br><span class="line">   MaxPermSize      = 85983232 (82.0MB)</span><br><span class="line">   G1HeapRegionSize = 0 (0.0MB)</span><br><span class="line"></span><br><span class="line">Heap Usage: //堆内存使用情况</span><br><span class="line">PS Young Generation</span><br><span class="line">Eden Space:</span><br><span class="line">   capacity = 5242880 (5.0MB)</span><br><span class="line">   used     = 3618584 (3.4509506225585938MB)</span><br><span class="line">   free     = 1624296 (1.5490493774414062MB)</span><br><span class="line">   69.01901245117188% used</span><br><span class="line">From Space:</span><br><span class="line">   capacity = 524288 (0.5MB)</span><br><span class="line">   used     = 229376 (0.21875MB)</span><br><span class="line">   free     = 294912 (0.28125MB)</span><br><span class="line">   43.75% used</span><br><span class="line">To Space:</span><br><span class="line">   capacity = 524288 (0.5MB)</span><br><span class="line">   used     = 0 (0.0MB)</span><br><span class="line">   free     = 524288 (0.5MB)</span><br><span class="line">   0.0% used</span><br><span class="line">PS Old Generation</span><br><span class="line">   capacity = 7340032 (7.0MB)</span><br><span class="line">   used     = 688224 (0.656341552734375MB)</span><br><span class="line">   free     = 6651808 (6.343658447265625MB)</span><br><span class="line">   9.376307896205358% used</span><br><span class="line">PS Perm Generation</span><br><span class="line">   capacity = 22020096 (21.0MB)</span><br><span class="line">   used     = 2633520 (2.5115203857421875MB)</span><br><span class="line">   free     = 19386576 (18.488479614257812MB)</span><br><span class="line">   11.959620884486608% used</span><br><span class="line"></span><br><span class="line">1522 interned Strings occupying 140184 bytes.</span><br></pre></td></tr></table></figure>
<h3 id="histo-live"><a href="#histo-live" class="headerlink" title="histo[:live]"></a>histo[:live]</h3><p>打印堆的对象统计，包括对象数、内存大小等等。jmap -histo:live 这个命令执行，JVM会先触发Full GC，然后再统计信息。带<code>live</code> 子选项的只会统计活对象。</p>
<pre><code>$ jmap -histo[:live] pid
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt; jmap -histo:live 13812 | more</span><br><span class="line"></span><br><span class="line"> num     #instances         #bytes  class name</span><br><span class="line">----------------------------------------------</span><br><span class="line">   1:          5833         752160  &lt;methodKlass&gt;</span><br><span class="line">   2:          5833         676232  &lt;constMethodKlass&gt;</span><br><span class="line">   3:           389         467400  &lt;constantPoolKlass&gt;</span><br><span class="line">   4:          1924         288568  [C</span><br><span class="line">   5:           352         280928  &lt;constantPoolCacheKlass&gt;</span><br><span class="line">   6:           389         266520  &lt;instanceKlassKlass&gt;</span><br><span class="line">   7:           545          91448  [B</span><br><span class="line">   8:           451          44296  java.lang.Class</span><br><span class="line">   9:          1775          42600  java.lang.String</span><br><span class="line">  10:           636          42400  [[I</span><br><span class="line">  11:           593          36448  [S</span><br><span class="line">  12:           785          31400  java.util.TreeMap$Entry</span><br><span class="line">  13:            45          24480  &lt;objArrayKlassKlass&gt;</span><br><span class="line">  14:            39          15752  &lt;methodDataKlass&gt;</span><br><span class="line">  15:           314          13352  [Ljava.lang.Object;</span><br><span class="line">  16:           187           7640  [Ljava.lang.String;</span><br><span class="line">  17:             8           4352  &lt;typeArrayKlassKlass&gt;</span><br><span class="line">  18:            93           3720  java.lang.ref.SoftReference</span><br><span class="line">  19:           114           3648  java.util.Hashtable$Entry</span><br><span class="line">  20:            37           2368  java.net.URL</span><br><span class="line">  21:            11           2288  &lt;klassKlass&gt;</span><br><span class="line">  22:            38           1824  sun.util.locale.LocaleObjectCache$CacheEntry</span><br><span class="line">  23:            55           1760  java.util.concurrent.ConcurrentHashMap$HashEntry</span><br><span class="line">  24:            44           1760  java.util.concurrent.ConcurrentHashMap$Segment</span><br><span class="line">  25:            38           1520  java.util.LinkedHashMap$Entry</span><br><span class="line">  26:            44           1408  java.util.concurrent.locks.ReentrantLock$NonfairSync</span><br><span class="line">  27:            44           1184  [Ljava.util.concurrent.ConcurrentHashMap$HashEntry;</span><br><span class="line">  28:            13           1168  [Ljava.util.HashMap$Entry;</span><br><span class="line">  29:             3           1112  [I</span><br><span class="line">  30:             1           1040  [[C</span><br><span class="line">  31:             6            992  [Ljava.util.Hashtable$Entry;</span><br><span class="line">  32:            36            864  java.io.ExpiringCache$Entry</span><br><span class="line">  33:            26            832  java.util.HashMap$Entry</span><br><span class="line">  34:            17            816  java.util.HashMap</span><br><span class="line">  35:            19            760  sun.util.locale.BaseLocale$Key</span><br><span class="line">  36:            19            760  java.io.ObjectStreamField</span><br><span class="line">  37:            10            720  java.lang.reflect.Constructor</span><br><span class="line">  38:             8            640  [Ljava.util.concurrent.ConcurrentHashMap$Segment;</span><br><span class="line">  39:             6            624  java.lang.Thread</span><br><span class="line">  40:            19            608  sun.util.locale.BaseLocale</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>jmap -histo:live 24971 | java.lang.String 查询类名包含java.lang.String的信息</p>
<p>jmap -histo:live 24971 | grep java.lang.String &gt; histo.txt 保存信息到histo.txt文件</p>
</blockquote>
<h3 id="permstat"><a href="#permstat" class="headerlink" title="permstat"></a>permstat</h3><p>打印Java堆内存的永久区的类加载器的智能统计信息。对于每个类加载器而言，它的名称、活跃度、地址、父类加载器、它所加载的类的数量和大小都会被打印。此外，包含的字符串数量和大小也会被打印。</p>
<p>使用方法：</p>
<pre><code>$ jmap -permstat pid
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;jmap -permstat 13812</span><br><span class="line">Attaching to process ID 13812, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 24.79-b02</span><br><span class="line">finding class loader instances ..done.</span><br><span class="line">computing per loader stat ..done.</span><br><span class="line">please wait.. computing liveness........done.</span><br><span class="line">class_loader    classes bytes   parent_loader   alive?  type</span><br><span class="line"></span><br><span class="line">&lt;bootstrap&gt;     388     2581896   null          live    &lt;internal&gt;</span><br><span class="line">0x00000000fec39b28      8       102232  0x00000000fec3a1c8      live    sun/misc/Launcher$AppClassLoader@0x00000000f9c3b030</span><br><span class="line">0x00000000fec3a1c8      0       0         null          live    sun/misc/Launcher$ExtClassLoader@0x00000000f9be6128</span><br><span class="line"></span><br><span class="line">total = 3       396     2684128     N/A         alive=3, dead=0     N/A</span><br></pre></td></tr></table></figure>
<h3 id="dump"><a href="#dump" class="headerlink" title="dump"></a>dump</h3><p>dump堆到文件,format指定输出格式，live指明是活着的对象,file指定文件名</p>
<pre><code>$ jmap -dump[:live],format=b,file=[filename].hprof pid    
</code></pre><p>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;jmap -dump:live,format=b,file=D:/dump.hprof 13812</span><br><span class="line">Dumping heap to D:\dump.hprof ...</span><br><span class="line">Heap dump file created</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>使用jmap来dump内存时，系统会被暂停，它会先做一次Full GC再dump内存。</p>
</blockquote>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2018/03/15/JVM工具/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2018-03-15T13:46:46.000Z"><a href="/2018/03/15/怎么从Spring官方网页下载PDF文档/">2018-03-15</a></time>
        
  
    <h1 class="title"><a href="/2018/03/15/怎么从Spring官方网页下载PDF文档/">怎么从Spring官方网页下载PDF文档</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#首先进入Spring官网"><span class="toc-text">首先进入Spring官网</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#然后选择要下载的项目文档"><span class="toc-text">然后选择要下载的项目文档</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#截取浏览器当前地址到docs"><span class="toc-text">截取浏览器当前地址到docs</span></a></li></ol>
    </div>

        <h1 id="首先进入Spring官网"><a href="#首先进入Spring官网" class="headerlink" title="首先进入Spring官网"></a>首先进入Spring官网</h1><p>官网地址：<a href="https://spring.io/docs/reference" target="_blank" rel="noopener">https://spring.io/docs/reference</a></p>
<p><img src="/img/spring doc.png" alt="spring doc"></p>
<h1 id="然后选择要下载的项目文档"><a href="#然后选择要下载的项目文档" class="headerlink" title="然后选择要下载的项目文档"></a>然后选择要下载的项目文档</h1><p>如上图这里选择spring boot项目，点击进去。<br>然后浏览器会出现这么一个地址：</p>
<p><a href="https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/reference/htmlsingle/" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs/2.0.0.RELEASE/reference/htmlsingle/</a></p>
<h1 id="截取浏览器当前地址到docs"><a href="#截取浏览器当前地址到docs" class="headerlink" title="截取浏览器当前地址到docs"></a>截取浏览器当前地址到docs</h1><p>即 <a href="https://docs.spring.io/spring-boot/docs，" target="_blank" rel="noopener">https://docs.spring.io/spring-boot/docs，</a><br>然后访问这个地址。<br>然后会进入到一个ftp的页面，然后根据自己的选择的版本进入。<br>这里选择进入<code>current</code>目录，即当前版本的目录。<br><img src="/img/current.png" alt="current"></p>
<p>然后进入就会看到<code>html</code>、<code>pdf</code>两个目录，那么选择<code>pdf</code>目录进去就是pdf文件了直接右键链接另存为就可以保存到本地了。</p>
<blockquote>
<p>其实可以直接输入这个地址就行，比如我要下载spring-data-redis的doc，那么直接输入<code>https://docs.spring.io/spring-data-redis/docs</code></p>
</blockquote>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2018/03/15/怎么从Spring官方网页下载PDF文档/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2018-03-14T14:42:23.000Z"><a href="/2018/03/14/1、hexo使用指南/">2018-03-14</a></time>
        
  
    <h1 class="title"><a href="/2018/03/14/1、hexo使用指南/">1、hexo使用指南</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#hexo使用指南"><span class="toc-text">hexo使用指南</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安装Git"><span class="toc-text">安装Git</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安装nodeJS"><span class="toc-text">安装nodeJS</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#安装hexo"><span class="toc-text">安装hexo</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#创建安装目录"><span class="toc-text">创建安装目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开始安装"><span class="toc-text">开始安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检测hexo安装是否成功"><span class="toc-text">检测hexo安装是否成功</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#初始化hexo"><span class="toc-text">初始化hexo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置hexo"><span class="toc-text">配置hexo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#体验hexo"><span class="toc-text">体验hexo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hexo主题安装"><span class="toc-text">hexo主题安装</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#hexo-官方地址"><span class="toc-text">hexo 官方地址</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#发布问题解决"><span class="toc-text">发布问题解决</span></a></li></ol>
    </div>

        <h1 id="hexo使用指南"><a href="#hexo使用指南" class="headerlink" title="hexo使用指南"></a>hexo使用指南</h1><h1 id="安装Git"><a href="#安装Git" class="headerlink" title="安装Git"></a>安装Git</h1><p>gitforwindos : <a href="https://gitforwindows.org/" target="_blank" rel="noopener">https://gitforwindows.org/</a></p>
<p>git downloads : <a href="https://git-scm.com/downloads" target="_blank" rel="noopener">https://git-scm.com/downloads</a><br>以上两个地址都可以下载安装，安装步骤参其他文档。</p>
<h1 id="安装nodeJS"><a href="#安装nodeJS" class="headerlink" title="安装nodeJS"></a>安装nodeJS</h1><p>官方网址：<a href="http://nodejs.cn/download/" target="_blank" rel="noopener">http://nodejs.cn/download/</a><br>进入官方地址进行下载然后安装，安装步骤很简单，就不进行演示了。</p>
<h1 id="安装hexo"><a href="#安装hexo" class="headerlink" title="安装hexo"></a>安装hexo</h1><p>在安装hexo之前假设你已经有了github账号了，以及安装了上述的git和nodejs环境。</p>
<h2 id="创建安装目录"><a href="#创建安装目录" class="headerlink" title="创建安装目录"></a>创建安装目录</h2><p>首先需要创建一个安装目录用于安装hexo，然后我这里创建了一个<code>blog</code>目录。</p>
<h2 id="开始安装"><a href="#开始安装" class="headerlink" title="开始安装"></a>开始安装</h2><p>进入<code>blog</code>目录，然后执行如下命令：</p>
<pre><code>$ npm install hexo -g
</code></pre><p>如果安装被墙了的话，需要安装<a href="https://npm.taobao.org/" target="_blank" rel="noopener">淘宝NPM镜像</a></p>
<pre><code>$ npm install -g cnpm --registry=https://registry.npm.taobao.org
</code></pre><blockquote>
<p>使用淘宝NPM安装Hexo :</p>
<pre><code>$ cnpm install -g hexo-cli
</code></pre></blockquote>
<p>安装过程中会打印如下日志：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo -g</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">C:\Users\tomgs\AppData\Roaming\npm\hexo -&gt; C:\Users\tomgs\AppData\Roaming\npm\node_modules\hexo\bin\hexo</span><br><span class="line"></span><br><span class="line">&gt; nunjucks@3.1.2 postinstall C:\Users\tomgs\AppData\Roaming\npm\node_modules\hexo\node_modules\nunjucks</span><br><span class="line">&gt; node postinstall-build.js src</span><br><span class="line"></span><br><span class="line">npm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.1.3 (node_modules\hexo\node_modules\fsevents):</span><br><span class="line">npm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.1.3: wanted &#123;&quot;os&quot;:&quot;darwin&quot;,&quot;arch&quot;:&quot;any&quot;&#125; (current: &#123;&quot;os&quot;:&quot;win32&quot;,&quot;arch&quot;:&quot;x64&quot;&#125;)</span><br><span class="line"></span><br><span class="line">+ hexo@3.6.0</span><br><span class="line">added 390 packages in 56.16s</span><br></pre></td></tr></table></figure></p>
<h2 id="检测hexo安装是否成功"><a href="#检测hexo安装是否成功" class="headerlink" title="检测hexo安装是否成功"></a>检测hexo安装是否成功</h2><p>输入如下命令：</p>
<pre><code>$ hexo -v 
</code></pre><p>出现如下结果说明成功:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ hexo -v</span><br><span class="line">hexo-cli: 1.1.0</span><br><span class="line">os: Windows_NT 10.0.16299 win32 x64</span><br><span class="line">http_parser: 2.7.0</span><br><span class="line">node: 8.9.3</span><br><span class="line">v8: 6.1.534.48</span><br><span class="line">uv: 1.15.0</span><br><span class="line">zlib: 1.2.11</span><br><span class="line">ares: 1.10.1-DEV</span><br><span class="line">modules: 57</span><br><span class="line">nghttp2: 1.25.0</span><br><span class="line">openssl: 1.0.2n</span><br><span class="line">icu: 59.1</span><br><span class="line">unicode: 9.0</span><br><span class="line">cldr: 31.0.1</span><br><span class="line">tz: 2017b</span><br></pre></td></tr></table></figure></p>
<h2 id="初始化hexo"><a href="#初始化hexo" class="headerlink" title="初始化hexo"></a>初始化hexo</h2><p>安装好之后接下来就来开始使用hexo。首先需要进行初始化，使用如下命令：</p>
<pre><code>$ hexo init
</code></pre><p>这个过程时间比较长，耐心等待就好。</p>
<p>然后还需要安装hexo所需要的插件，使用如下命令:</p>
<pre><code>$ npm install
</code></pre><h2 id="配置hexo"><a href="#配置hexo" class="headerlink" title="配置hexo"></a>配置hexo</h2><p>在初始化好hexo之后下面就需要进行配置了。在<code>init</code>目录下面有个<code>_config.yml</code>文件，这个就是hexo的配置文件，可以在这里进行博客的各种配置操作。</p>
<p>可以参考官方文档的配置选项章节进行详细的配置：<a href="https://hexo.io/zh-cn/docs/configuration.html" target="_blank" rel="noopener">https://hexo.io/zh-cn/docs/configuration.html</a></p>
<p>示例如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Site</span><br><span class="line">title: Tomgs&apos;s blog     -- 网址标题</span><br><span class="line">subtitle: tomgsV5@gmail.com     -- 网址副标题</span><br><span class="line">description: lalala     -- 网址简介，主要用于SEO</span><br><span class="line">author: tomgs           -- 你的名字</span><br><span class="line">language: zh-CN         -- 网址使用的语言</span><br><span class="line">timezone:               -- 网站的时区</span><br><span class="line">theme: ligth-ch         -- hexo主题</span><br></pre></td></tr></table></figure></p>
<h2 id="体验hexo"><a href="#体验hexo" class="headerlink" title="体验hexo"></a>体验hexo</h2><p>在本地进行预览，首先进入<code>init</code>目录，然后进行如下操作步骤。</p>
<p>第一步：新建一篇文章</p>
<pre><code>$ hexo new &quot;titleName&quot;
</code></pre><p>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new &quot;1、hexo使用指南&quot;</span><br><span class="line">INFO  Created: F:\blog\init\source\_posts\1、hexo使用指南.md</span><br></pre></td></tr></table></figure></p>
<p>然后可以用markdown工具进行编辑，或者用markdown编辑之后复制进来也是可以的。</p>
<p>这里说明一下文章的头部:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: 1、hexo使用指南</span><br><span class="line">date: 2018-02-01 00:42:04</span><br><span class="line">categories:  //这个地方可以配置文件的分类</span><br><span class="line">- nodejs     //一级分类</span><br><span class="line">- hexo       //二级分类</span><br><span class="line">tags:   //这个地方添加文章的标签</span><br><span class="line">- hexoL</span><br><span class="line">---</span><br></pre></td></tr></table></figure></p>
<p>第二步：先需要生成静态文件</p>
<pre><code>$ hexo -g/generate
</code></pre><p>第三步：发布草稿，这步可以不用，直接进行第三步</p>
<pre><code>$ hexo p/publish &lt;filename&gt;
</code></pre><p>第四步：启动本地服务器</p>
<pre><code>$ hexo s/server
</code></pre><p>启动服务器</p>
<blockquote>
<p>选项 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;描述 <br><br>-p, –port&nbsp;&nbsp;&nbsp;    重设端口 <br><br>-s, –static    &nbsp;&nbsp;只使用静态文件 <br><br>-l, –log    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;启动日记记录，使用覆盖记录格式 <br></p>
</blockquote>
<p>示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hexo s -p 8080</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http://localhost:8080/. Press Ctrl+C to stop.</span><br></pre></td></tr></table></figure></p>
<p>然后就可以访问<code>http://localhost:8080/</code>进行博客的访问。</p>
<p>第五步：将文件发布到远程服务器上</p>
<p>这个需要进行配置git，然后在_config.yml中配置deployment选项：<br>git配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">设置git身份信息</span><br><span class="line">$ git config --global user.name &quot;你的用户名&quot;</span><br><span class="line">$ git config --global user.email &quot;你的邮箱&quot;</span><br></pre></td></tr></table></figure></p>
<p>heox怎么配置deployment，只需要在_config.yml配置文件中配置如下的信息即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https://github.com/tincopper/tincopper.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>这个仓库的创建需要按照如下格式创建，就是仓库名（Repository name）要和你的owner名字一致。</p>
<p>比如我的owner叫：<strong><em>tincopper</em></strong></p>
<p>那么你的Repository name 需要取如下名字: <strong><em>tincopper</em></strong>.github.io</p>
</blockquote>
<p>还需要一步就是安装hexo-deployer-git自动部署发布工具</p>
<pre><code>$ npm instal lhexo-deployer-git  --save
</code></pre><p>然后进行发布</p>
<pre><code>$ hexo d/deploy [-g]
</code></pre><blockquote>
<p>带上-g, –generate 表示部署之前预先生成静态文件</p>
</blockquote>
<h2 id="hexo主题安装"><a href="#hexo主题安装" class="headerlink" title="hexo主题安装"></a>hexo主题安装</h2><p>hexo提供了很多的主题可供选择，官方主题地址：<a href="https://hexo.io/themes/" target="_blank" rel="noopener">https://hexo.io/themes/</a></p>
<p>然后使用如下命令进行主题下载</p>
<pre><code>git https://github.com/iissnan/hexo-theme-next themes/next(next为主题名)
</code></pre><p>然后还需要在_config.yml中进行配置：</p>
<pre><code>theme: next
</code></pre><h1 id="hexo-官方地址"><a href="#hexo-官方地址" class="headerlink" title="hexo 官方地址"></a>hexo 官方地址</h1><p><a href="https://hexo.io/zh-cn/" target="_blank" rel="noopener">https://hexo.io/zh-cn/</a></p>
<p>里面有文档、API、配置、插件、主题等相关资源可供学习。</p>
<h1 id="发布问题解决"><a href="#发布问题解决" class="headerlink" title="发布问题解决"></a>发布问题解决</h1><p>1、fatal: HttpRequestException encountered.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">fatal: HttpRequestException encountered.</span><br><span class="line">   ▒▒▒▒▒▒▒▒ʱ▒▒▒▒</span><br><span class="line">bash: /dev/tty: No such device or address</span><br><span class="line">error: failed to execute prompt script (exit code 1)</span><br><span class="line">fatal: could not read Username for &apos;https://github.com&apos;: No error</span><br><span class="line">FATAL Something&apos;s wrong. Maybe you can find the solution here: http://hexo.io/docs/troubleshooting.html</span><br><span class="line">Error: fatal: HttpRequestException encountered.</span><br><span class="line">   ��������ʱ����</span><br><span class="line">bash: /dev/tty: No such device or address</span><br><span class="line">error: failed to execute prompt script (exit code 1)</span><br><span class="line">fatal: could not read Username for &apos;https://github.com&apos;: No error</span><br><span class="line"></span><br><span class="line">    at ChildProcess.&lt;anonymous&gt; (F:\blog\init\node_modules\hexo-util\lib\spawn.js:37:17)</span><br><span class="line">    at emitTwo (events.js:126:13)</span><br><span class="line">    at ChildProcess.emit (events.js:214:7)</span><br><span class="line">    at ChildProcess.cp.emit (F:\blog\init\node_modules\cross-spawn\lib\enoent.js:40:29)</span><br><span class="line">    at maybeClose (internal/child_process.js:925:16)</span><br><span class="line">    at Process.ChildProcess._handle.onexit (internal/child_process.js:209:5)</span><br></pre></td></tr></table></figure></p>
<p>解决方法：使用ssh的方式进行连接，可以参考其他的文档如：<a href="http://blog.sina.com.cn/s/blog_4c44643f0102vuju.html" target="_blank" rel="noopener">http://blog.sina.com.cn/s/blog_4c44643f0102vuju.html</a><br><br><a href="https://help.github.com/articles/connecting-to-github-with-ssh/" target="_blank" rel="noopener">https://help.github.com/articles/connecting-to-github-with-ssh/</a></p>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2018/03/14/1、hexo使用指南/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2018-01-31T16:42:04.000Z"><a href="/2018/02/01/MySQL架构学习回顾/">2018-02-01</a></time>
        
  
    <h1 class="title"><a href="/2018/02/01/MySQL架构学习回顾/">MySQL架构学习回顾</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#逻辑架构"><span class="toc-text">逻辑架构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#锁"><span class="toc-text">锁</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#事务四大特性"><span class="toc-text">事务四大特性</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#事务四种隔离级别"><span class="toc-text">事务四种隔离级别</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#死锁"><span class="toc-text">死锁</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#事务日志"><span class="toc-text">事务日志</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#事务"><span class="toc-text">事务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#多版本并发控制-MVCC"><span class="toc-text">多版本并发控制(MVCC)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#存储引擎"><span class="toc-text">存储引擎</span></a></li></ol>
    </div>

        <h1 id="逻辑架构"><a href="#逻辑架构" class="headerlink" title="逻辑架构"></a>逻辑架构</h1><p>了解MySQL的架构有助于深入理解MySQL服务器，下图是MySQL的三层逻辑架构图（图片来自于网络）。<br><img src="http://p1.pstatp.com/large/5e6f000615c7616a86c1" alt="image"></p>
<p>第一层用于对客户端的连接处理、安全认证、授权等。每个客户端连接都会在服务端拥有一个线程，每个连接发起的查询都会在对应的单独线程中执行。</p>
<p>第二层包含了MySQL的核心服务功能，包括查询解析、分析、查询缓存、内置函数、存储过程、触发器、视图等。当客户端发起请求时，如果是SELECT操作，MySQL会先检查是否命中查询缓存，命中则直接返回查询缓存中的数据；否则，MySQL会解析查询并创建对应的内部数据结构(解析树)，执行各种优化，然后执行。</p>
<p>第三层包含了存储引擎，存储引擎负责数据的存储和提取。MySQL中有很多种不同类型的存储引擎，每个存储引擎各不相同，MySQL服务器通过API与存储引擎通信，屏蔽了各种存储引擎之间的差异。</p>
<h1 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h1><p>MySQL在处理并发读和写的时候，分别使用共享锁(读锁)和排它锁(写锁)。</p>
<p>对共享资源高并发操作，在加锁的时候，最好能只锁定所需要的数据，控制锁的粒度、提高并发能力。MySQL提供了两种最重要的锁策略，表级锁和行级锁。</p>
<p>表级锁，即锁定整张表。在对表进行插入、更新、删除操作时，需要先获得写锁，锁定整张表，其它读写操作将会被阻塞。读锁之间是不会阻塞的。需要注意的是alter table操作会使用表级锁，所以对数据量很大的表进行alter table操作时，需要谨慎。</p>
<p>行级锁，即只锁定数据所在的行，行级锁只在存储引擎层实现。行级锁可以很好的支持并发处理，但是也会导致大量的资源开销。</p>
<h1 id="事务四大特性"><a href="#事务四大特性" class="headerlink" title="事务四大特性"></a>事务四大特性</h1><p>四大特性(ACID)：原子性(Atomicity)、一致性(Consistency)、隔离性(Isolation)、持久性(Durability)。</p>
<p>原子性：一个事务中的所有操作，要么全部成功执行，要么全部失败回滚；</p>
<p>一致性：事务执行结果使数据库从一个一致性状态变到另一个一致性状态；</p>
<p>隔离性：事务操作提交之前，操作结果对其它事务不可见；</p>
<p>持久性：事务提交后，所有的修改操作会永久保存到数据库中。</p>
<h1 id="事务四种隔离级别"><a href="#事务四种隔离级别" class="headerlink" title="事务四种隔离级别"></a>事务四种隔离级别</h1><p>SQL标准中定义了四种隔离级别，分别是Read Uncommitted、Read Committed、Repeatable Read、Serializable。</p>
<p>Read Uncommitted：该隔离级别下，事务中未提交的数据对其它事务是可见的，即其它事务可以读取到未提交事务的数据，出现脏读。</p>
<p>Read Committed：该隔离级别下，事务只能读取到已提交事务所改变的数据，解决了脏读的问题，但是会出现不可重复读，即在一个事务前后两次读取某数据的中间时刻，有其它事务修改了该数据，导致两次读取的数据不一致。</p>
<p>Repeatable Read：该隔离级别是MySQL数据库的默认事务隔离级别，它解决了不可重复读的问题，但是会出现幻读，即事务在读取某范围内的数据时，其它事务在该范围内插入了新纪录，导致之前的事务再次读取会不一致。</p>
<p>Serializable：最高的隔离级别，该隔离级别下，通过强制事务串行执行、在读取的每一行数据上加锁，来避免出现幻读的问题。因为读取的数据每行上都会加锁，可能会导致大量的超时和锁竞争问题，所以一般不使用该级别，除非是数据一致性要求特别高的情况。</p>
<p>下面通过一张图清晰的展示各隔离级别。<br><img src="http://p3.pstatp.com/large/5e770000a42bc3797514" alt="image"></p>
<p>MySQL可以通过执行SET TRANSACTION ISOLATION LEVEL命令来设置隔离级别，新设置的隔离级别将在下一个事务开始的时候生效。</p>
<h1 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h1><p>死锁是指多个事务在同一资源上相互占用，并请求锁定对方所占用的资源，从而导致的恶性循环现象。</p>
<p>数据库系统为了解决这个问题，实现了死锁检测和死锁超时机制。在MySQL的InnoDB存储引擎中，解决死锁的方法是将持有最少行级排它锁的事务进行回滚。</p>
<h1 id="事务日志"><a href="#事务日志" class="headerlink" title="事务日志"></a>事务日志</h1><p>事务日志，即一种特殊的操作记录日志。</p>
<p>存储引擎在修改表数据的时候，只修改内存中的拷贝，然后将修改行为记录保存到硬盘上的事务日志中，对事务日志的保存操作采用追加的方式，保存操作是顺序IO，相对于存储引擎直接将数据持久化到硬盘的随机IO高效的多。事务日志保存后，内存中被修改的数据在后台可以慢慢的持久化到硬盘。如果事务日志保存成功了，而内存中被修改的数据没有成功的写入硬盘，发生了系统崩溃，存储引擎会在重启时自动恢复这部分数据。</p>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><p>MySQL中的事务是在存储引擎中实现的，所以上层的服务是不会管理事务的。默认情况下，MySQL自身提供了两种事务型的存储引擎，分别是InnnoDB和NDB Cluster。</p>
<p>在默认情况下，MySQL事务采用自动提交模式，即如果没有显示的开启一个事务，那么每一次的查询都将被当做一个事务执行自动提交。当然，也可以通过设置来改变这种自动提交的模式。如果想开启自动提交，可以通过命令SET AUTOCOMMIT = 1或SET AUTOCOMMIT = ON来设置；关闭自动提交模式，可以通过命令SET AUTOCOMMIT = 0或SET AUTOCOMMIT = OFF来设置。</p>
<p>InnoDB存储引擎采用的是两阶段锁定协议，在事务执行的过程中，InnoDB会根据隔离级别在需要加锁的时候自定加锁，锁只有在事务提交或回滚的时候才会释放。当然，也可以显示的加锁，如使用SELECT FOR UPDATE，也可以使用服务层实现的LOCK TABLES和UNLOCK TABLES。</p>
<h1 id="多版本并发控制-MVCC"><a href="#多版本并发控制-MVCC" class="headerlink" title="多版本并发控制(MVCC)"></a>多版本并发控制(MVCC)</h1><p>基于对并发性能的考虑，MySQL的大多数事务型存储引擎都实现了多版本并发控制，可以简单的认为MVCC是行级锁的一个变种，但是它在很多情况下避免了加锁操作，降低了开销。</p>
<p>InnoDB的MVCC是通过在每行记录后添加两个隐藏列来实现的，一个列用于保存行的创建时间，一个列用于保存行的过期时间，这两个时间在实际存储的时候，存储的是系统版本号。每开始一个新事务，系统版本号都将递增。需要注意的是MVCC只能在Read Committed和Repeatable Read隔离级别下正常工作。</p>
<h1 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h1><p>MySQL自身和第三方提供了多种存储引擎，每种存储引擎优势各不相同，可以根据实际业务需要来选择对应的存储引擎。</p>
<p>InnoDB是MySQL的默认事务型存储引擎，主要用来处理大量的短期型事务。它采用MVCC来支持高并发，默认的事务隔离级别是Repeatable Read，并通过间隙锁策略防止幻读的出现。InnoDB表是基于聚簇索引建立的，而聚簇索引可以提高对主键查询的性能，但是它的二级索引(非主键索引)中必须包含主键，如果主键列很大，并且有很多个二级索引，那么这些索引将会占用很大的空间和资源，所以在创建主键的时候尽量的小。</p>
<p>在MySQL5.1及之前的版本中，MyISAM是默认的存储引擎，它提供了全文索引、压缩、空间函数等功能，但是它不支持事务和行级锁，并且崩溃后无法安全恢复，而InnoDB引擎是可以自动崩溃恢复的。MyISAM在并发的情况下，对整张表加锁，读操作会对需要读的所有表加共享锁，写入时对表加排它锁。</p>
<p>转载自：<a href="https://www.toutiao.com/i6516737990536987139/" target="_blank" rel="noopener">https://www.toutiao.com/i6516737990536987139/</a></p>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2018/02/01/MySQL架构学习回顾/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2018-01-07T15:40:27.000Z"><a href="/2018/01/07/java-collections/">2018-01-07</a></time>
        
  
    <h1 class="title"><a href="/2018/01/07/java-collections/">java collections</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#java-collections"><span class="toc-text">java collections</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#List"><span class="toc-text">List</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Set"><span class="toc-text">Set</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Map"><span class="toc-text">Map</span></a></li></ol></li></ol>
    </div>

        <h1 id="java-collections"><a href="#java-collections" class="headerlink" title="java collections"></a>java collections</h1><h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2>
      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2018/01/07/java-collections/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="photo">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2018-01-07T14:06:39.000Z"><a href="/2018/01/07/photo/My-Gallery/">2018-01-07</a></time>
        
  
    <h1 class="title"><a href="/2018/01/07/photo/My-Gallery/">My Gallery</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        
    </div>

        
      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2018/01/07/photo/My-Gallery/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



 
<nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>
</div></div>
      <aside id="sidebar" class="alignright">
  
<div class="widget tag">
  <h3 class="title" id="categories">分类</h3>
     <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/JVM/">JVM</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/集合框架/">集合框架</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring/">spring</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工具/压测/">压测</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/MySQL/">MySQL</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/编程/hexo教程/">hexo教程</a><span class="category-list-count">1</span></li></ul></li></ul> 
</div>
 


  <div class="widget tag">
  <h3 class="title">微信公众账号</h3>
    <ul class="entry">
      <img src="/img/default/qrcode.jpg" alt="欢迎关注个人公众账号" style= "width: 100%">
    </ul>
</div>

  


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/JVM/">JVM</a><small>1</small></li>
  
    <li><a href="/tags/MySQL/">MySQL</a><small>1</small></li>
  
    <li><a href="/tags/ab压测工具/">ab压测工具</a><small>1</small></li>
  
    <li><a href="/tags/hexo/">hexo</a><small>1</small></li>
  
    <li><a href="/tags/java/">java</a><small>2</small></li>
  
    <li><a href="/tags/spring/">spring</a><small>1</small></li>
  
    <li><a href="/tags/集合框架/">集合框架</a><small>1</small></li>
  
  </ul>
</div>



  
  <div class="widget tag">
    <h3 class="title">归档</h3>
	<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">公元 2018 年</a><span class="archive-list-count">7</span></li></ul>
  </div>

</aside>
      <div class="clearfix"></div>
    </div>
  
  <footer id="footer"><div class="footer-content inner">
  <div class="alignleft">
  
    &copy; 2018 tomgs
    
  </div>
  <!-- <div class="alignright">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme
    <a href="https://github.com/pengloo53/Hexo-theme-light_cn">light_cn</a>, 
    <p>Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a></p>
  </div> -->
  
  <div class="visit">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
  </div>
  
  <div class="clearfix"></div>
</div>
</footer>
  <script src="http://libs.baidu.com/jquery/2.1.1/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<!-- calendar widget -->


<!-- 『不蒜子』计数服务 -->
<script async src="http://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- 百度统计 -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c4ec2c7a97d8bada21b93c3a78422b39";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


<!-- wumii关联推荐 -->
<script type="text/javascript" src="http://widget.wumii.cn/ext/relatedItemsWidget"></script>

<!-- 百度推荐 -->

	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?"c4ec2c7a97d8bada21b93c3a78422b39;
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>



<!-- 返回顶部 -->
<div id="toTop">
	<a href="#">▲</a>
	<a href="#footer">▼</a>
</div>

<!-- 站内搜索-Swiftype -->
<!-- <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
  
  _st('install','sC-iNFrvTTNtiXEVNwo1','2.0.0');
</script> -->

<!-- fancybox -->

<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>
<!-- 
<a href="https://github.com/tincopper" target="_blank"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_white_ffffff.png" alt="Fork me on GitHub"></a>
-->