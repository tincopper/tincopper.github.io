<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tomgs&#39;s blog</title>
  <meta name="author" content="tomgs">
  
  <meta name="description" content="Java学习">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="Tomgs&#39;s blog"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="alternate" href="/atom.xml" title="Tomgs&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <!-- wumiiVerification -->
  <meta name="wumiiVerification" content="fb50a101-84fe-4ca2-91a7-ae8cf792978b" />
  <meta name="wumiiVerification" content="d73b5866-c390-4156-a4dd-51b526b5335e" />
  <!-- favicon -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!-- Font-Awesome -->
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">

</head>

<body>
  <header id="header"><div class= "header-content inner">
	<div class = "alignleft col-one">
		
			<div class='avatar'>
				<img src = "/img/default/avatar.jpg">
              </div>
		
		<div class="header-div">
		    <h1><a href="/">Tomgs&#39;s blog</a></h1>
		    <h2><a href="/">tomgsV5@gmail.com</a></h2>
		</div>
	</div>
	<div class = "alignright col-two">
		
	</div>
	<div class="clearfix"></div>
</div>

<div class= "header-nav">
	<div class='header-nav-content inner'>
		<div id="main-nav" class="alignleft">
		    		
		    		  <a href="/"><i class="fa fa-home"></i>首页</a>
		    		
		    		  <a href="/archives"><i class="fa fa-archive"></i>归档</a>
		    		
		    		  <a href="/categories/java"><i class="fa fa-book"></i>电子书</a>
		    		
		</div>
		<div id="sub-nav" class="alignright">
		    
		      <a href="/about"><i class="fa fa-user"></i>关于我</a>
		    
		</div>
	</div>
	<div class="clearfix"></div>
</div>
</header>
  
    <div id="content" class="inner">
      <div id="main-col" class="alignleft"><div id="wrapper">
    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2018-04-19T15:19:52.000Z"><a href="/2018/04/19/1、扩展spring-mvc，实现自定义参数转换/">2018-04-19</a></time>
        
  
    <h1 class="title"><a href="/2018/04/19/1、扩展spring-mvc，实现自定义参数转换/">1、扩展spring-mvc，实现自定义参数转换</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#需要明白的问题"><span class="toc-text">需要明白的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Spring-MVC处理-RequestBody和-ResponseBody的流程分析"><span class="toc-text">1. Spring MVC处理@RequestBody和@ResponseBody的流程分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Spring-MVC如何处理json请求参数"><span class="toc-text">2. Spring MVC如何处理json请求参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Spring-MVC如何处理json返回对象"><span class="toc-text">3. Spring MVC如何处理json返回对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-如何进行自定义扩展"><span class="toc-text">3. 如何进行自定义扩展</span></a></li></ol></li></ol>
    </div>

        <h1 id="需要明白的问题"><a href="#需要明白的问题" class="headerlink" title="需要明白的问题"></a>需要明白的问题</h1><p><br></p>
<h2 id="1-Spring-MVC处理-RequestBody和-ResponseBody的流程分析"><a href="#1-Spring-MVC处理-RequestBody和-ResponseBody的流程分析" class="headerlink" title="1. Spring MVC处理@RequestBody和@ResponseBody的流程分析"></a>1. Spring MVC处理@RequestBody和@ResponseBody的流程分析</h2><p>在SpringMVC 默认处理JSON格式数据是通过@RequestBody和@ResponseBody注解进行参数绑定，<strong><em><code>RequestResponseBodyMethodProcessor</code></em></strong> 这个类实现了对RequestBody和ResponseBody注解的处理。</p>
<p>RequestResponseBodyMethodProcessor类的层级关系如下：<br><img src="http://img.blog.csdn.net/20180117221331530?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVG9tZ3M=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="RequestResponseBodyMethodProcessor类结构"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RequestResponseBodyMethodProcessor 源码</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestResponseBodyMethodProcessor</span> <span class="keyword">extends</span> <span class="title">AbstractMessageConverterMethodProcessor</span> </span>&#123;</span><br><span class="line">    <span class="comment">//中间省略了部分代码</span></span><br><span class="line">    ...   </span><br><span class="line">true<span class="meta">@Override</span></span><br><span class="line">true<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsParameter</span><span class="params">(MethodParameter parameter)</span> </span>&#123;</span><br><span class="line">truetrue<span class="keyword">return</span> parameter.hasParameterAnnotation(RequestBody.class);</span><br><span class="line">true&#125;</span><br><span class="line"></span><br><span class="line">true<span class="meta">@Override</span></span><br><span class="line">true<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supportsReturnType</span><span class="params">(MethodParameter returnType)</span> </span>&#123;</span><br><span class="line">truetrue<span class="keyword">return</span> (AnnotatedElementUtils.hasAnnotation(returnType.getContainingClass(), ResponseBody.class) ||</span><br><span class="line">truetruetruetruereturnType.hasMethodAnnotation(ResponseBody.class));</span><br><span class="line">true&#125;</span><br><span class="line">true</span><br><span class="line">true<span class="comment">//处理请求参数</span></span><br><span class="line">true<span class="meta">@Override</span></span><br><span class="line">true<span class="function"><span class="keyword">public</span> Object <span class="title">resolveArgument</span><span class="params">(MethodParameter parameter, ModelAndViewContainer mavContainer,</span></span></span><br><span class="line"><span class="function"><span class="params">			NativeWebRequest webRequest, WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">truetrueparameter = parameter.nestedIfOptional();</span><br><span class="line">truetrueObject arg = readWithMessageConverters(webRequest, parameter, parameter.getNestedGenericParameterType());</span><br><span class="line">truetrueString name = Conventions.getVariableNameForParameter(parameter);</span><br><span class="line"></span><br><span class="line">truetrueWebDataBinder binder = binderFactory.createBinder(webRequest, arg, name);</span><br><span class="line">truetrue<span class="keyword">if</span> (arg != <span class="keyword">null</span>) &#123;</span><br><span class="line">truetruetruevalidateIfApplicable(binder, parameter);</span><br><span class="line">truetruetrue<span class="keyword">if</span> (binder.getBindingResult().hasErrors() &amp;&amp; isBindExceptionRequired(binder, parameter)) &#123;</span><br><span class="line">truetruetruetrue<span class="keyword">throw</span> <span class="keyword">new</span> MethodArgumentNotValidException(parameter, binder.getBindingResult());</span><br><span class="line">truetruetrue&#125;</span><br><span class="line">truetrue&#125;</span><br><span class="line">truetruemavContainer.addAttribute(BindingResult.MODEL_KEY_PREFIX + name, binder.getBindingResult());</span><br><span class="line"></span><br><span class="line">truetrue<span class="keyword">return</span> adaptArgumentIfNecessary(arg, parameter);</span><br><span class="line">true&#125;</span><br><span class="line">true</span><br><span class="line">true<span class="comment">//处理返回参数</span></span><br><span class="line">true<span class="meta">@Override</span></span><br><span class="line">true<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleReturnValue</span><span class="params">(Object returnValue, MethodParameter returnType,</span></span></span><br><span class="line"><span class="function"><span class="params">			ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> IOException, HttpMediaTypeNotAcceptableException, HttpMessageNotWritableException </span>&#123;</span><br><span class="line"></span><br><span class="line">truetruemavContainer.setRequestHandled(<span class="keyword">true</span>);</span><br><span class="line">truetrueServletServerHttpRequest inputMessage = createInputMessage(webRequest);</span><br><span class="line">truetrueServletServerHttpResponse outputMessage = createOutputMessage(webRequest);</span><br><span class="line"></span><br><span class="line">truetrue<span class="comment">// Try even with null return value. ResponseBodyAdvice could get involved.</span></span><br><span class="line">truetruewriteWithMessageConverters(returnValue, returnType, inputMessage, outputMessage);</span><br><span class="line">true&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到它是继承了 <strong><em><code>AbstractMessageConverterMethodProcessor</code></em></strong> 抽象类，那么我们可以参考上面考虑自己继承这个抽象类以达到自定义我们自己的注解功能实现不同请求参数和返回参数的处理。知道这一步了怎么处理是很容易的，但是又引申出了下面这个问题，就是我们扩展了这个类之后那么在那一步进行调用呢？<br><br>我们可以先看一下默认的是怎么处理的，如 <strong><em><code>RequestResponseBodyMethodProcessor</code></em></strong>  是在哪里被进行调用的，可以看到是在 <strong><em><code>RequestMappingHandlerAdapter</code></em></strong> 这么一个适配器类 进行调用的，还有另外一个类也进行了调用但是和这里流程无关。看一下 <strong><em><code>RequestMappingHandlerAdapter</code></em></strong> 类的介绍：</p>
<blockquote>
<p>An <strong><em><code>AbstractHandlerMethodAdapter</code></em></strong> (Abstract base class for <strong><em><code>HandlerAdapter</code></em></strong> implementations that support handlers of type <strong><em><code>HandlerMethod</code></em></strong>.) that supports <strong><em><code>HandlerMethod</code></em></strong> with their method argument and return type signature, as defined via <strong><em><code>@RequestMapping</code></em></strong>.<br><br>Support for custom argument and return value types can be added via <code>setCustomArgumentResolvers</code> and <code>setCustomReturnValueHandlers</code>. Or alternatively, to re-configure all argument and return value types, use <code>setArgumentResolvers</code> and <code>setReturnValueHandlers</code>.</p>
</blockquote>
<p>其继承了 <strong><em><code>AbstractHandlerMethodAdapter</code></em></strong>，实现了通过 <strong><em><code>@RequestMapping</code></em></strong> 注解支持HandlerMethods及其方法参数和返回类型签名。<br>且支持自定义参数和返回值类型可以通过 <strong><em><code>setCustomArgumentResolvers</code></em></strong> 和 <strong><em><code>setCustomReturnValueHandlers</code></em></strong> 添加； 如果要重新配置所有参数和返回值类型，则使用 <strong><em><code>setArgumentResolvers</code></em></strong> 和 <strong><em><code>setReturnValueHandlers</code></em></strong>，因为有一些SpringMVC默认处理请求参数和返回值的处理类，如 <strong><em><code>RequestResponseBodyMethodProcessor</code></em></strong> 就是其中 默认之一，建议是不进行设置，而是设置自定义即可，可以从 <strong><em><code>RequestMappingHandlerAdapter</code></em></strong> 类源码的相关方法看出什么原因：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置参数处理器</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setArgumentResolvers</span><span class="params">(List&lt;HandlerMethodArgumentResolver&gt; argumentResolvers)</span> </span>&#123;</span><br><span class="line">true<span class="keyword">if</span> (argumentResolvers == <span class="keyword">null</span>) &#123;</span><br><span class="line">truetrue<span class="keyword">this</span>.argumentResolvers = <span class="keyword">null</span>;</span><br><span class="line">true&#125;</span><br><span class="line">true<span class="keyword">else</span> &#123;</span><br><span class="line">truetrue<span class="keyword">this</span>.argumentResolvers = <span class="keyword">new</span> HandlerMethodArgumentResolverComposite();</span><br><span class="line">truetrue<span class="keyword">this</span>.argumentResolvers.addResolvers(argumentResolvers);</span><br><span class="line">true&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//初始化参数和返回值处理器</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">true<span class="comment">// Do this first, it may add ResponseBody advice beans</span></span><br><span class="line">trueinitControllerAdviceCache();</span><br><span class="line"></span><br><span class="line">true<span class="keyword">if</span> (<span class="keyword">this</span>.argumentResolvers == <span class="keyword">null</span>) &#123;</span><br><span class="line">truetrueList&lt;HandlerMethodArgumentResolver&gt; resolvers = getDefaultArgumentResolvers();</span><br><span class="line">truetrue<span class="keyword">this</span>.argumentResolvers = <span class="keyword">new</span> HandlerMethodArgumentResolverComposite().addResolvers(resolvers);</span><br><span class="line">true&#125;</span><br><span class="line">true<span class="keyword">if</span> (<span class="keyword">this</span>.initBinderArgumentResolvers == <span class="keyword">null</span>) &#123;</span><br><span class="line">truetrueList&lt;HandlerMethodArgumentResolver&gt; resolvers = getDefaultInitBinderArgumentResolvers();</span><br><span class="line">truetrue<span class="keyword">this</span>.initBinderArgumentResolvers = <span class="keyword">new</span> HandlerMethodArgumentResolverComposite().addResolvers(resolvers);</span><br><span class="line">true&#125;</span><br><span class="line">true<span class="keyword">if</span> (<span class="keyword">this</span>.returnValueHandlers == <span class="keyword">null</span>) &#123;</span><br><span class="line">truetrueList&lt;HandlerMethodReturnValueHandler&gt; handlers = getDefaultReturnValueHandlers();</span><br><span class="line">truetrue<span class="keyword">this</span>.returnValueHandlers = <span class="keyword">new</span> HandlerMethodReturnValueHandlerComposite().addHandlers(handlers);</span><br><span class="line">true&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>深入的看下去可以发现还实现了 <strong><em><code>HandlerAdapter</code></em></strong> 接口。如下图所示：<br><img src="http://img.blog.csdn.net/20180117204337533?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVG9tZ3M=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="RequestMappingHandlerAdapter结构图"></p>
<p>看到这应该知道 <strong><em><code>RequestMappingHandlerAdapter</code></em></strong> 类的作用了,用来处理 <strong><em><code>@RequestMapping</code></em></strong> 标识的方法。<br><strong><em><code>HandlerAdapter</code></em></strong> 主要就是功能实际就是执行我们的具体的Controller、Servlet或者HttpRequestHandler中的方法。可以看到这个接口也是一个适配接口，每一个处理请求的Handler必须实现这个这个接口，以达到无限扩展 <strong><em><code>DispatcherServlet</code></em></strong>。那么这个接口的执行过程其实就是在 <strong><em><code>DispatcherServlet</code></em></strong> 中的 <code>doDispatch()</code>方法中调用的。</p>
<blockquote>
<p>可以在eclipse中使用 ctrl+shift+g查询一下这个接口在那些类里面有被引用就知道了。<br><img src="http://img.blog.csdn.net/20180117210459567?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvVG9tZ3M=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="HandlerAdapter被调用的类"></p>
</blockquote>
<p>如上图可以看到，除了 <strong><em><code>DispatcherServlet</code></em></strong> 其余几个都是其实现类。</p>
<p>再来看一下这个 <code>doDispatch()</code>方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Process the actual dispatching to the handler.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;The handler will be obtained by applying the servlet's HandlerMappings in order.</span></span><br><span class="line"><span class="comment"> ---&gt; 这就是为什么AbstractHandlerMethodAdapter实现了Order接口的原因。</span></span><br><span class="line"><span class="comment"> * The HandlerAdapter will be obtained by querying the servlet's installed HandlerAdapters</span></span><br><span class="line"><span class="comment"> * to find the first that supports the handler class.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;All HTTP methods are handled by this method. It's up to HandlerAdapters or handlers</span></span><br><span class="line"><span class="comment"> * themselves to decide which methods are acceptable.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> request current HTTP request</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> response current HTTP response</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception in case of any kind of processing failure</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//中间省略了部分代码</span></span><br><span class="line">true<span class="comment">// Determine handler for the current request.</span></span><br><span class="line">truemappedHandler = getHandler(processedRequest);</span><br><span class="line">    </span><br><span class="line">true<span class="comment">// Determine handler adapter for the current request.</span></span><br><span class="line">trueHandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line"></span><br><span class="line">true<span class="comment">// Process last-modified header, if supported by the handler.</span></span><br><span class="line">true...</span><br><span class="line">true<span class="keyword">if</span> (isGet || <span class="string">"HEAD"</span>.equals(method)) &#123;</span><br><span class="line">truetrue<span class="keyword">long</span> lastModified = ha.getLastModified(request, </span><br><span class="line">true&#125;</span><br><span class="line">    <span class="comment">// interceptor preHandle</span></span><br><span class="line">    <span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</span><br><span class="line">truetrue<span class="keyword">return</span>;</span><br><span class="line">true&#125;</span><br><span class="line">    </span><br><span class="line">true<span class="comment">// Actually invoke the handler.</span></span><br><span class="line">truemv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">// interceptor postHandle</span></span><br><span class="line">    mappedHandler.applyPostHandle(processedRequest, response, mv);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>可以看到<code>getHandlerAdapter</code>的操作就是选择合适的HandlerAdapter来执行，这就是设计模式中的适配器模式。<br>handlerAdapters中的内容就是所有的HandlerAdapter的实现类。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the HandlerAdapter for this handler object.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> handler the handler object to find an adapter for</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ServletException if no HandlerAdapter can be found for the handler. This is a fatal error.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> HandlerAdapter <span class="title">getHandlerAdapter</span><span class="params">(Object handler)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">true<span class="keyword">for</span> (HandlerAdapter ha : <span class="keyword">this</span>.handlerAdapters) &#123;</span><br><span class="line">truetrue<span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">truetruetruelogger.trace(<span class="string">"Testing handler adapter ["</span> + ha + <span class="string">"]"</span>);</span><br><span class="line">truetrue&#125;</span><br><span class="line">truetrue<span class="keyword">if</span> (ha.supports(handler)) &#123;</span><br><span class="line">truetruetrue<span class="keyword">return</span> ha;</span><br><span class="line">truetrue&#125;</span><br><span class="line">true&#125;</span><br><span class="line">true<span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"No adapter for handler ["</span> + handler +</span><br><span class="line">truetruetrue<span class="string">"]: The DispatcherServlet configuration needs to include a HandlerAdapter that supports this handler"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>后面调用<code>handle</code>方法，里面完成对请求参数的封装，调用和返回处理的流程处理，这样就完成了Handler的真正调用过程，最终调用过程是返回一个ModelAndView对象。</p>
<p>看到这里应该也了解了SpringMVC的一个具体请求流程内部大概是怎么样处理的了，这里从一个反向的过程去推导的。</p>
<p>可以参考<a href="http://blog.csdn.net/qq924862077/article/details/53842993" target="_blank" rel="noopener">HandlerAdapter源码分析</a>详细了解这个类的作用。</p>
<h2 id="2-Spring-MVC如何处理json请求参数"><a href="#2-Spring-MVC如何处理json请求参数" class="headerlink" title="2. Spring MVC如何处理json请求参数"></a>2. Spring MVC如何处理json请求参数</h2><blockquote>
<p>那么首先需要知道@RequestBody的工作原理</p>
</blockquote>
<p>经过上面的分析可以知道处理请求参数的是在 <code>RequestResponseBodyMethodProcessor</code>中resolveArgument方法进行相关参数的处理。代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">resolveArgument</span><span class="params">(MethodParameter parameter, ModelAndViewContainer mavContainer,</span></span></span><br><span class="line"><span class="function"><span class="params">		NativeWebRequest webRequest, WebDataBinderFactory binderFactory)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//返回此MethodParameter的一个变体，该变体指向相同的参数，但在java.util.Optional声明的情况下进行一层嵌套。</span></span><br><span class="line">trueparameter = parameter.nestedIfOptional();</span><br><span class="line">true</span><br><span class="line">true<span class="comment">//请求参数转换器</span></span><br><span class="line">trueObject arg = readWithMessageConverters(webRequest, parameter, parameter.getNestedGenericParameterType());</span><br><span class="line">true</span><br><span class="line">true<span class="comment">//确定提供的参数的常规变量名称，并考虑通用集合类型（如果有的话）。</span></span><br><span class="line">trueString name = Conventions.getVariableNameForParameter(parameter);</span><br><span class="line"></span><br><span class="line">trueWebDataBinder binder = binderFactory.createBinder(webRequest, arg, name);</span><br><span class="line">true<span class="keyword">if</span> (arg != <span class="keyword">null</span>) &#123;</span><br><span class="line">truetruevalidateIfApplicable(binder, parameter);</span><br><span class="line">truetrue<span class="keyword">if</span> (binder.getBindingResult().hasErrors() &amp;&amp; isBindExceptionRequired(binder, parameter)) &#123;</span><br><span class="line">truetruetrue<span class="keyword">throw</span> <span class="keyword">new</span> MethodArgumentNotValidException(parameter, binder.getBindingResult());</span><br><span class="line">truetrue&#125;</span><br><span class="line">true&#125;</span><br><span class="line">truemavContainer.addAttribute(BindingResult.MODEL_KEY_PREFIX + name, binder.getBindingResult());</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//将给定的参数与方法参数进行匹配</span></span><br><span class="line">true<span class="keyword">return</span> adaptArgumentIfNecessary(arg, parameter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="3-Spring-MVC如何处理json返回对象"><a href="#3-Spring-MVC如何处理json返回对象" class="headerlink" title="3. Spring MVC如何处理json返回对象"></a>3. Spring MVC如何处理json返回对象</h2><blockquote>
<p>那么首先需要知道@ResponseBody 的工作原理</p>
</blockquote>
<p>经过上面的分析可以知道处理返回参数是在 <code>RequestResponseBodyMethodProcessor</code>中handleReturnValue方法进行相关参数的处理。代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">handleReturnValue</span><span class="params">(Object returnValue, MethodParameter returnType,</span></span></span><br><span class="line"><span class="function"><span class="params">		ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span></span></span><br><span class="line"><span class="function">		<span class="keyword">throws</span> IOException, HttpMediaTypeNotAcceptableException, HttpMessageNotWritableException </span>&#123;</span><br><span class="line"></span><br><span class="line">truemavContainer.setRequestHandled(<span class="keyword">true</span>);</span><br><span class="line">trueServletServerHttpRequest inputMessage = createInputMessage(webRequest);</span><br><span class="line">trueServletServerHttpResponse outputMessage = createOutputMessage(webRequest);</span><br><span class="line"></span><br><span class="line">true<span class="comment">// Try even with null return value. ResponseBodyAdvice could get involved.</span></span><br><span class="line">truewriteWithMessageConverters(returnValue, returnType, inputMessage, outputMessage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="3-如何进行自定义扩展"><a href="#3-如何进行自定义扩展" class="headerlink" title="3. 如何进行自定义扩展"></a>3. 如何进行自定义扩展</h2><blockquote>
<p><strong>TODO:</strong> 贴出流程图、为什么要进行扩展、扩展之后的好处与不扩展的对比、还有没有其他的方式，为什么选择这一种进行扩展，后续分析…</p>
<p><strong>TODO:</strong> 分析实例：方法参数转换实现接口自动化验签和签名</p>
</blockquote>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2018/04/19/1、扩展spring-mvc，实现自定义参数转换/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2018-04-06T03:02:17.000Z"><a href="/2018/04/06/AB压测工具使用/">2018-04-06</a></time>
        
  
    <h1 class="title"><a href="/2018/04/06/AB压测工具使用/">AB压测工具使用</a></h1>
  

    </header>

    <div class="entry">
      
        <h1 id="AB压测工具的使用"><a href="#AB压测工具的使用" class="headerlink" title="AB压测工具的使用"></a>AB压测工具的使用</h1><p>官网：<br><a href="http://mirror.bit.edu.cn/apache/httpd/" target="_blank" rel="noopener">http://mirror.bit.edu.cn/apache/httpd/</a><br><a href="http://httpd.apache.org/docs/2.4/programs/ab.html" target="_blank" rel="noopener">http://httpd.apache.org/docs/2.4/programs/ab.html</a><br><a href="http://httpd.apache.org/docs/2.2/" target="_blank" rel="noopener">http://httpd.apache.org/docs/2.2/</a></p>
<h1 id="什么是AB"><a href="#什么是AB" class="headerlink" title="什么是AB"></a>什么是AB</h1><p>它是Apache服务器的一个命令，ab命令模拟多线程并发请求，测试服务器负载压力，也可以测试nginx、lighthttp、IIS等其它Web服务器的压力。<br>ab命令对发出负载的计算机要求很低，既不会占用很多CPU，也不会占用太多的内存，但却会给目标服务器造成巨大的负载，因此是某些DDOS攻击之必备良药，老少皆宜。自己使用也须谨慎。否则压测负载过多，造成目标服务器直接因内存耗光死机，而不得不硬重启，得不偿失。<br>在带宽不足的情况下，最好是本机进行测试，建议使用内网的另一台或者多台服务器通过内网进行测试，这样得出的数据，准确度会高很多。远程对web服务器进行压力测试，往往效果不理想（因为网络延时过大或带宽不足）<br>
      
    </div>
    <footer>
      
        
          <div class="alignleft">
            <a href="/2018/04/06/AB压测工具使用/#more" class="more-link">Read More</a>
          </div>
        
        
        <div class="alignright">
          <a href="/2018/04/06/AB压测工具使用/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




    <article class="post">
  
  <div class="post-content">
    <header>
        <div class="icon"></div>
        
        <time datetime="2018-03-15T15:56:51.000Z"><a href="/2018/03/15/JVM工具/">2018-03-15</a></time>
        
  
    <h1 class="title"><a href="/2018/03/15/JVM工具/">JVM工具</a></h1>
  

    </header>

    <div class="entry">
      
        
    <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#jps"><span class="toc-text">jps</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#用法"><span class="toc-text">用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参数"><span class="toc-text">参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例："><span class="toc-text">示例：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jinfo"><span class="toc-text">jinfo</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#用法："><span class="toc-text">用法：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参数："><span class="toc-text">参数：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#选项："><span class="toc-text">选项：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例：-1"><span class="toc-text">示例：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jstack"><span class="toc-text">jstack</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#用法-1"><span class="toc-text">用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#选项"><span class="toc-text">选项</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例"><span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jstat"><span class="toc-text">jstat</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#用法-2"><span class="toc-text">用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#选项-1"><span class="toc-text">选项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#option"><span class="toc-text">option</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例-1"><span class="toc-text">示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#gc"><span class="toc-text">-gc</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gcutil"><span class="toc-text">-gcutil</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gcnew"><span class="toc-text">-gcnew</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jmap"><span class="toc-text">jmap</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#用法-3"><span class="toc-text">用法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#选项说明"><span class="toc-text">选项说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例-2"><span class="toc-text">示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#heap"><span class="toc-text">heap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#histo-live"><span class="toc-text">histo[:live]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#permstat"><span class="toc-text">permstat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dump"><span class="toc-text">dump</span></a></li></ol></li></ol></li></ol>
    </div>

        <h1 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h1><p>JPS 查看当前运行java进程<br>JVM Process Status Tool,显示指定系统内所有的HotSpot虚拟机进程。</p>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">jps </span>-lvm 用于查看当前机器上运行的<span class="keyword">java进程。 </span></span><br><span class="line"></span><br><span class="line">命令格式 <span class="keyword">jps </span>[options] [hostid] </span><br><span class="line">注：如果不指定hostid就默认为当前主机或服务器。</span><br></pre></td></tr></table></figure>
<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><blockquote>
<p>常用命令行参数选项说明如下： <br><br>-q &nbsp;不输出类名、Jar名和传入main方法的参数 <br><br>-m 输出传入main方法的参数 <br><br>-l &nbsp;&nbsp;输出main类或Jar的全限名 <br><br>-v &nbsp;输出传入JVM的参数<br><br>-V 输出通过标记的文件传递给JVM的参数（.hotspotrc文件，或者是通过参数-XX:Flags=指定的文件）。<br><br>-J 用于传递jvm选项到由javac调用的java加载器中，例如，“-J-Xms48m”将把启动内存设置为48M，使用-J选项可以非常方便的向基于Java的开发的底层虚拟机应用程序传递参数。</p>
</blockquote>
<p>jps有问题, 使用 jps -J-Djps.debug=true -J-Djps.printStackTrace=true 可以获得Jps错误详细信息</p>
<h2 id="示例："><a href="#示例：" class="headerlink" title="示例："></a>示例：</h2><p>jps -lvm<br><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:<span class="symbol">\U</span>sers<span class="symbol">\t</span>omgs&gt;jps -lvm</span><br><span class="line">6116 org.apache.catalina.startup.Bootstrap start -agentlib:jdwp=transport=dt_socket,suspend=y,address=localhost:63138 -Djava.net.preferIPv4Stack=true -Dcatalina.base=E:<span class="symbol">\a</span>pache-tomcat-7.0.65 -Dcatalina.home=E:<span class="symbol">\a</span>pache-tomcat-7.0.65 -Dwtp.deploy=E:<span class="symbol">\a</span>pache-tomcat-7.0.65<span class="symbol">\m</span>e-webapps -Djava.endorsed.dirs=E:<span class="symbol">\a</span>pache-tomcat-7.0.65<span class="symbol">\e</span>ndorsed -Dfile.encoding=UTF-8</span><br><span class="line">6000 sun.tools.jps.Jps -lvm -Denv.class.path=.;D:<span class="symbol">\a</span>pps<span class="symbol">\J</span>ava<span class="symbol">\j</span>dk1.7<span class="symbol">\b</span>in;D:<span class="symbol">\a</span>pps<span class="symbol">\J</span>ava<span class="symbol">\j</span>dk1.7<span class="symbol">\l</span>ib<span class="symbol">\d</span>t.jar;D:<span class="symbol">\a</span>pps<span class="symbol">\J</span>ava<span class="symbol">\j</span>dk1.7<span class="symbol">\l</span>ib<span class="symbol">\t</span>ools.jar -Dapplication.home=D:<span class="symbol">\a</span>pps<span class="symbol">\J</span>ava<span class="symbol">\j</span>dk1.7 -Xms8m</span><br><span class="line">12892 C:<span class="symbol">\U</span>sers<span class="symbol">\t</span>omgs<span class="symbol">\A</span>ppData<span class="symbol">\L</span>ocal<span class="symbol">\T</span>emp<span class="symbol">\p</span>ul9953.tmp<span class="symbol">\P</span>ULSEI~1.JAR -os win32 -ws win32 -arch x86_64 -showsplash -launcher D:<span class="symbol">\a</span>pps<span class="symbol">\M</span>yEclipse 2015 CI<span class="symbol">\m</span>yeclipse.exe -name Myeclipse --launcher.library D:<span class="symbol">\a</span>pps<span class="symbol">\M</span>yEclipse 2015 CI<span class="symbol">\p</span>lugins/org.eclipse.equinox.launcher.i18n.win32.win32.x86_64_3.2.0.v201103301700<span class="symbol">\e</span>clipse_3215.dll -startup D:<span class="symbol">\a</span>pps<span class="symbol">\M</span>yEclipse 2015 CI<span class="symbol">\p</span>lugins/org.eclipse.equinox.launcher_1.3.0.v20140415-2008.jar -exitdata 8ac_f4 -install D:<span class="symbol">\a</span>pps<span class="symbol">\M</span>yEclipse 2015 CI -vm D:<span class="symbol">\a</span>pps<span class="symbol">\M</span>yEclipse 2015 CI<span class="symbol">\b</span>inary/com.sun.java.jdk7.win32.x86_64_1.7.0.u45/bin/javaw.exe -vmargs -Xmx2048m -Xms512m -XX:PermSize=256m -XX:MaxPermSize=512m -XX:ReservedCodeCacheSize=128m -Dosgi.nls.warnings=ignore -Dfile.encoding=UTF-8 -jar C:<span class="symbol">\U</span>sers<span class="symbol">\t</span>omgs<span class="symbol">\A</span>ppData<span class="symbol">\L</span>ocal<span class="symbol">\T</span>emp<span class="symbol">\p</span>ul9953.tmp<span class="symbol">\P</span>ULSEI~1.JAR -Xmx2048m -Xms512m -XX:PermSize=256m -XX:MaxPermSize=512m -XX:ReservedCodeCacheSize=128m -Dosgi.nls.warnings=ignore -Dfile.encoding=UTF-8</span><br></pre></td></tr></table></figure></p>
<p>jps -l<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">C</span>:\<span class="selector-tag">Users</span>\<span class="selector-tag">tomgs</span>&gt;<span class="selector-tag">jps</span> <span class="selector-tag">-l</span></span><br><span class="line">6116 <span class="selector-tag">org</span><span class="selector-class">.apache</span><span class="selector-class">.catalina</span><span class="selector-class">.startup</span><span class="selector-class">.Bootstrap</span></span><br><span class="line">12124 <span class="selector-tag">sun</span><span class="selector-class">.tools</span><span class="selector-class">.jps</span><span class="selector-class">.Jps</span></span><br><span class="line">12892 <span class="selector-tag">C</span>:\<span class="selector-tag">Users</span>\<span class="selector-tag">tomgs</span>\<span class="selector-tag">AppData</span>\<span class="selector-tag">Local</span>\<span class="selector-tag">Temp</span>\<span class="selector-tag">pul9953</span><span class="selector-class">.tmp</span>\<span class="selector-tag">PULSEI</span>~1<span class="selector-class">.JAR</span></span><br></pre></td></tr></table></figure></p>
<p>jps -V<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;<span class="keyword">jps </span>-V</span><br><span class="line"><span class="number">13108</span> <span class="keyword">Jps</span></span><br><span class="line"><span class="keyword">6116 </span><span class="keyword">Bootstrap</span></span><br><span class="line"><span class="keyword">12892 </span>PULSEI~<span class="number">1</span>.<span class="keyword">JAR</span></span><br></pre></td></tr></table></figure></p>
<h1 id="jinfo"><a href="#jinfo" class="headerlink" title="jinfo"></a>jinfo</h1><p>该命令可以打印出java进程的配置信息：包括jvm参数，系统属性等</p>
<h2 id="用法："><a href="#用法：" class="headerlink" title="用法："></a>用法：</h2><figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jinfo [ <span class="keyword">option</span> ] pid</span><br><span class="line">jinfo [ <span class="keyword">option</span> ] executable core</span><br><span class="line">jinfo [ <span class="keyword">option</span> ] [<span class="built_in">server</span>-id@]remote-hostname-<span class="keyword">or</span>-IP</span><br></pre></td></tr></table></figure>
<h2 id="参数："><a href="#参数：" class="headerlink" title="参数："></a>参数：</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pid   进程号</span><br><span class="line"><span class="built_in">executable</span>   产生core dump的java <span class="built_in">executable</span></span><br><span class="line">core   core <span class="keyword">file</span></span><br><span class="line">remote-<span class="built_in">hostname</span>-<span class="built_in">or</span>-IP  主机名或ip</span><br><span class="line">server-id    远程主机上的<span class="keyword">debug</span> server的唯一id</span><br></pre></td></tr></table></figure>
<h2 id="选项："><a href="#选项：" class="headerlink" title="选项："></a>选项：</h2><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">no option  打印命令行参数和系统属性</span><br><span class="line">-<span class="ruby">flags  打印命令行参数</span></span><br><span class="line"><span class="ruby">-sysprops  打印系统属性</span></span><br><span class="line"><span class="ruby">-h  帮助</span></span><br></pre></td></tr></table></figure>
<h2 id="示例：-1"><a href="#示例：-1" class="headerlink" title="示例："></a>示例：</h2><p>jinfo pid<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;jinfo <span class="number">6116</span></span><br><span class="line">Attaching to process ID <span class="number">6116</span>, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is <span class="number">24.79</span>-b02</span><br><span class="line">Java System Properties:</span><br><span class="line"></span><br><span class="line">java<span class="selector-class">.vendor</span> = Oracle Corporation</span><br><span class="line">sun<span class="selector-class">.java</span><span class="selector-class">.launcher</span> = SUN_STANDARD</span><br><span class="line">catalina<span class="selector-class">.base</span> = E:\apache-tomcat-<span class="number">7.0</span>.<span class="number">65</span></span><br><span class="line">sun<span class="selector-class">.management</span><span class="selector-class">.compiler</span> = HotSpot <span class="number">64</span>-Bit Tiered Compilers</span><br><span class="line">catalina<span class="selector-class">.useNaming</span> = true</span><br><span class="line">os<span class="selector-class">.name</span> = Windows <span class="number">8.1</span></span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">wtp<span class="selector-class">.deploy</span> = E:\apache-tomcat-<span class="number">7.0</span>.<span class="number">65</span>\me-webapps</span><br><span class="line">PAYMENT_LOG_PATH = E:\apache-tomcat-<span class="number">7.0</span>.<span class="number">65</span>\me-webapps\z_test_payment-gateway\logs</span><br><span class="line">java<span class="selector-class">.vm</span><span class="selector-class">.name</span> = Java HotSpot(TM) <span class="number">64</span>-Bit Server VM</span><br><span class="line">file<span class="selector-class">.encoding</span> = UTF-<span class="number">8</span></span><br><span class="line">java<span class="selector-class">.specification</span><span class="selector-class">.version</span> = <span class="number">1.7</span></span><br><span class="line"></span><br><span class="line">VM Flags: <span class="comment">//JVM参数</span></span><br><span class="line"></span><br><span class="line">-agentlib:jdwp=transport=dt_socket,suspend=y,address=localhost:<span class="number">63138</span> -Djava<span class="selector-class">.net</span><span class="selector-class">.preferIPv4Stack</span>=true -Dcatalina.base=E:\apache-tomcat-<span class="number">7.0</span>.<span class="number">65</span> -Dcatalina.home=E:\apache-tomcat-<span class="number">7.0</span>.<span class="number">65</span> -Dwtp.deploy=E:\apache-tomcat-<span class="number">7.0</span>.<span class="number">65</span>\me-webapps -Djava<span class="selector-class">.endorsed</span><span class="selector-class">.dirs</span>=E:\apache-tomcat-<span class="number">7.0</span>.<span class="number">65</span>\endorsed -Dfile.encoding=UTF-<span class="number">8</span></span><br></pre></td></tr></table></figure></p>
<p>jinfo -flags pid<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;jinfo -flags 6116</span><br><span class="line">Attaching <span class="keyword">to</span> process ID 6116, please wait<span class="built_in">..</span>.</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 24.79-b02</span><br><span class="line"></span><br><span class="line">-agentlib:<span class="attribute">jdwp</span>=transport=dt_socket,suspend=y,address=localhost:63138 -Djava.net.<span class="attribute">preferIPv4Stack</span>=<span class="literal">true</span> -Dcatalina.<span class="attribute">base</span>=E:\apache-tomcat-7.0.65 -Dcatalina.<span class="attribute">home</span>=E:\apache-tomcat-7.0.65 -Dwtp.<span class="attribute">deploy</span>=E:\apache-tomcat-7.0.65\me-webapps -Djava.endorsed.<span class="attribute">dirs</span>=E:\apache-tomcat-7.0.65\endorsed -Dfile.<span class="attribute">encoding</span>=UTF-8</span><br></pre></td></tr></table></figure></p>
<h1 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h1><p>打印线程信息</p>
<h2 id="用法-1"><a href="#用法-1" class="headerlink" title="用法"></a>用法</h2><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack <span class="string">[ option ]</span> pid</span><br></pre></td></tr></table></figure>
<h2 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h2><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">l 打印锁信息</span></span><br><span class="line"><span class="ruby">-m 打印java和native的帧信息</span></span><br><span class="line"><span class="ruby">-F 强制dump，当jstack没有响应时使用</span></span><br></pre></td></tr></table></figure>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>将线程pid为120的线程dump到c盘的a.txt文件中<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack <span class="number">1200</span> <span class="meta">&gt;&gt; </span><span class="symbol">C:</span>\a.txt</span><br></pre></td></tr></table></figure></p>
<p>分析另起文章说明。</p>
<h1 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h1><p>jstat(JVM statistics Monitoring)是用于监视虚拟机运行时状态信息的命令，它可以显示出虚拟机进程中的类装载、内存、垃圾收集、JIT编译等运行数据。</p>
<p>详细请见官方文档介绍：<a href="https://docs.oracle.com/javase/7/docs/technotes/tools/share/jstat.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/7/docs/technotes/tools/share/jstat.html</a></p>
<h2 id="用法-2"><a href="#用法-2" class="headerlink" title="用法"></a>用法</h2><pre><code>jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]]
</code></pre><h2 id="选项-1"><a href="#选项-1" class="headerlink" title="选项"></a>选项</h2><blockquote>
<p>option - 选项，我们一般使用 -gcutil 查看gc情况</p>
<p>vmid - VM的进程号，即当前运行的java进程号</p>
<p>interval - 间隔时间，单位为秒或者毫秒</p>
<p>count - 打印次数，如果缺省则打印无数次</p>
</blockquote>
<h3 id="option"><a href="#option" class="headerlink" title="option"></a>option</h3><table>
<thead>
<tr>
<th>Option</th>
<th>Displays</th>
</tr>
</thead>
<tbody>
<tr>
<td>class</td>
<td>Statistics on the behavior of the class loader.</td>
</tr>
<tr>
<td>compiler</td>
<td>Statistics of the behavior of the HotSpot Just-in-Time compiler.</td>
</tr>
<tr>
<td><strong><em>gc</em></strong></td>
<td>Statistics of the behavior of the garbage collected heap.</td>
</tr>
<tr>
<td><strong><em>gccapacity</em></strong></td>
<td>Statistics of the capacities of the generations</td>
<td>and their corresponding spaces.</td>
</tr>
<tr>
<td>gccause</td>
<td>Summary of garbage collection statistics (same as -gcutil), with the cause of the last and current</td>
<td>(if applicable) garbage collection events.</td>
</tr>
<tr>
<td><strong><em>gcnew</em></strong></td>
<td>Statistics of the behavior of the new generation.</td>
</tr>
<tr>
<td>gcnewcapacity</td>
<td>Statistics of the sizes of the new generations</td>
<td>and its corresponding spaces.</td>
</tr>
<tr>
<td><strong><em>gcold</em></strong></td>
<td>Statistics of the behavior of the old and permanent generations.</td>
</tr>
<tr>
<td>gcoldcapacity</td>
<td>Statistics of the sizes of the old generation.</td>
</tr>
<tr>
<td>gcpermcapacity</td>
<td>Statistics of the sizes of the permanent generation.</td>
</tr>
<tr>
<td><strong><em>gcutil</em></strong></td>
<td>Summary of garbage collection statistics.</td>
</tr>
<tr>
<td>printcompilation</td>
<td>HotSpot compilation method statistics.</td>
</tr>
</tbody>
</table>
<h2 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h2><h3 id="gc"><a href="#gc" class="headerlink" title="-gc"></a>-gc</h3><pre><code>jstat -gc pid [interval] [count]
</code></pre><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">C</span>:\<span class="selector-tag">Users</span>\<span class="selector-tag">tomgs</span>&gt;<span class="selector-tag">jstat</span> <span class="selector-tag">-gc</span> 12760</span><br><span class="line"> <span class="selector-tag">S0C</span>    <span class="selector-tag">S1C</span>    <span class="selector-tag">S0U</span>    <span class="selector-tag">S1U</span>      <span class="selector-tag">EC</span>       <span class="selector-tag">EU</span>        <span class="selector-tag">OC</span>         <span class="selector-tag">OU</span>       <span class="selector-tag">PC</span>     <span class="selector-tag">PU</span>    <span class="selector-tag">YGC</span>     <span class="selector-tag">YGCT</span>    <span class="selector-tag">FGC</span>    <span class="selector-tag">FGCT</span>     <span class="selector-tag">GCT</span>  </span><br><span class="line">512<span class="selector-class">.0</span>  512<span class="selector-class">.0</span>   0<span class="selector-class">.0</span>   184<span class="selector-class">.4</span>   3072<span class="selector-class">.0</span>   1438<span class="selector-class">.0</span>    7168<span class="selector-class">.0</span>     605<span class="selector-class">.4</span>    21504<span class="selector-class">.0</span> 2572<span class="selector-class">.2</span>    121    0<span class="selector-class">.163</span>   0      0<span class="selector-class">.000</span>    0<span class="selector-class">.163</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">C</span>:\<span class="selector-tag">Users</span>\<span class="selector-tag">tomgs</span>&gt;<span class="selector-tag">jstat</span> <span class="selector-tag">-gc</span> 12760 250 6</span><br><span class="line"> <span class="selector-tag">S0C</span>    <span class="selector-tag">S1C</span>    <span class="selector-tag">S0U</span>    <span class="selector-tag">S1U</span>      <span class="selector-tag">EC</span>       <span class="selector-tag">EU</span>        <span class="selector-tag">OC</span>         <span class="selector-tag">OU</span>       <span class="selector-tag">PC</span>     <span class="selector-tag">PU</span>    <span class="selector-tag">YGC</span>     <span class="selector-tag">YGCT</span>    <span class="selector-tag">FGC</span>    <span class="selector-tag">FGCT</span>     <span class="selector-tag">GCT</span>  </span><br><span class="line">512<span class="selector-class">.0</span>  512<span class="selector-class">.0</span>  208<span class="selector-class">.3</span>   0<span class="selector-class">.0</span>    3072<span class="selector-class">.0</span>   1262<span class="selector-class">.1</span>    7168<span class="selector-class">.0</span>     605<span class="selector-class">.4</span>    21504<span class="selector-class">.0</span> 2572<span class="selector-class">.5</span>    166    0<span class="selector-class">.229</span>   0      0<span class="selector-class">.000</span>    0<span class="selector-class">.229</span></span><br><span class="line">512<span class="selector-class">.0</span>  512<span class="selector-class">.0</span>   0<span class="selector-class">.0</span>   256<span class="selector-class">.0</span>   3072<span class="selector-class">.0</span>   2376<span class="selector-class">.6</span>    7168<span class="selector-class">.0</span>     605<span class="selector-class">.4</span>    21504<span class="selector-class">.0</span> 2572<span class="selector-class">.5</span>    167    0<span class="selector-class">.231</span>   0      0<span class="selector-class">.000</span>    0<span class="selector-class">.231</span></span><br><span class="line">512<span class="selector-class">.0</span>  512<span class="selector-class">.0</span>   0<span class="selector-class">.0</span>   240<span class="selector-class">.3</span>   3072<span class="selector-class">.0</span>    0<span class="selector-class">.0</span>      7168<span class="selector-class">.0</span>     605<span class="selector-class">.4</span>    21504<span class="selector-class">.0</span> 2572<span class="selector-class">.5</span>    169    0<span class="selector-class">.233</span>   0      0<span class="selector-class">.000</span>    0<span class="selector-class">.233</span></span><br><span class="line">512<span class="selector-class">.0</span>  512<span class="selector-class">.0</span>  192<span class="selector-class">.0</span>   0<span class="selector-class">.0</span>    3072<span class="selector-class">.0</span>   315<span class="selector-class">.4</span>     7168<span class="selector-class">.0</span>     605<span class="selector-class">.4</span>    21504<span class="selector-class">.0</span> 2572<span class="selector-class">.5</span>    170    0<span class="selector-class">.234</span>   0      0<span class="selector-class">.000</span>    0<span class="selector-class">.234</span></span><br><span class="line">512<span class="selector-class">.0</span>  512<span class="selector-class">.0</span>   0<span class="selector-class">.0</span>   240<span class="selector-class">.3</span>   3072<span class="selector-class">.0</span>   1689<span class="selector-class">.4</span>    7168<span class="selector-class">.0</span>     605<span class="selector-class">.4</span>    21504<span class="selector-class">.0</span> 2572<span class="selector-class">.7</span>    171    0<span class="selector-class">.236</span>   0      0<span class="selector-class">.000</span>    0<span class="selector-class">.236</span></span><br><span class="line">512<span class="selector-class">.0</span>  512<span class="selector-class">.0</span>   0<span class="selector-class">.0</span>   160<span class="selector-class">.0</span>   3072<span class="selector-class">.0</span>    0<span class="selector-class">.0</span>      7168<span class="selector-class">.0</span>     605<span class="selector-class">.4</span>    21504<span class="selector-class">.0</span> 2572<span class="selector-class">.7</span>    173    0<span class="selector-class">.238</span>   0      0<span class="selector-class">.000</span>    0<span class="selector-class">.238</span></span><br></pre></td></tr></table></figure>
<p>说明：</p>
<blockquote>
<p>C 即Capacity 总容量，U 即Used 已使用的容量 <br><br>S0C : survivor0区的总容量 <br><br>S1C : survivor1区的总容量 <br><br>S0U : survivor0区已使用的容量 <br><br>S1C : survivor1区已使用的容量 <br><br>EC : Eden区的总容量 <br><br>EU : Eden区已使用的容量 <br><br>OC : Old区的总容量 <br><br>OU : Old区已使用的容量 <br><br>MC ：方法区大小 <br><br>MU ：方法区使用大小 <br><br>CCSC : 压缩类空间大小 <br><br>CCSU : 压缩类空间使用大小 <br><br>YGC : 新生代垃圾回收次数 <br><br>YGCT : 新生代垃圾回收时间 <br><br>FGC : 老年代垃圾回收次数 <br><br>FGCT : 老年代垃圾回收时间 <br><br>GCT : 垃圾回收总消耗时间 <br></p>
</blockquote>
<h3 id="gcutil"><a href="#gcutil" class="headerlink" title="-gcutil"></a>-gcutil</h3><pre><code>jstat -gcutil pid [interval] [count]
</code></pre><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcutil <span class="number">21891</span> <span class="number">250</span> <span class="number">7</span></span><br><span class="line">  </span><br><span class="line">  S0     S1     E      O      P     YGC    YGCT    FGC    FGCT     GCT</span><br><span class="line"></span><br><span class="line"> <span class="number">12.44</span>   <span class="number">0.00</span>  <span class="number">27.20</span>   <span class="number">9.49</span>  <span class="number">96.70</span>    <span class="number">78</span>    <span class="number">0.176</span>     <span class="number">5</span>    <span class="number">0.495</span>    <span class="number">0.672</span></span><br><span class="line"></span><br><span class="line"> <span class="number">12.44</span>   <span class="number">0.00</span>  <span class="number">62.16</span>   <span class="number">9.49</span>  <span class="number">96.70</span>    <span class="number">78</span>    <span class="number">0.176</span>     <span class="number">5</span>    <span class="number">0.495</span>    <span class="number">0.672</span></span><br><span class="line"></span><br><span class="line"> <span class="number">12.44</span>   <span class="number">0.00</span>  <span class="number">83.97</span>   <span class="number">9.49</span>  <span class="number">96.70</span>    <span class="number">78</span>    <span class="number">0.176</span>     <span class="number">5</span>    <span class="number">0.495</span>    <span class="number">0.672</span></span><br><span class="line"></span><br><span class="line">  <span class="number">0.00</span>   <span class="number">7.74</span>   <span class="number">0.00</span>   <span class="number">9.51</span>  <span class="number">96.70</span>    <span class="number">79</span>    <span class="number">0.177</span>     <span class="number">5</span>    <span class="number">0.495</span>    <span class="number">0.673</span></span><br><span class="line"></span><br><span class="line">  <span class="number">0.00</span>   <span class="number">7.74</span>  <span class="number">23.37</span>   <span class="number">9.51</span>  <span class="number">96.70</span>    <span class="number">79</span>    <span class="number">0.177</span>     <span class="number">5</span>    <span class="number">0.495</span>    <span class="number">0.673</span></span><br><span class="line"></span><br><span class="line">  <span class="number">0.00</span>   <span class="number">7.74</span>  <span class="number">43.82</span>   <span class="number">9.51</span>  <span class="number">96.70</span>    <span class="number">79</span>    <span class="number">0.177</span>     <span class="number">5</span>    <span class="number">0.495</span>    <span class="number">0.673</span></span><br><span class="line"></span><br><span class="line">  <span class="number">0.00</span>   <span class="number">7.74</span>  <span class="number">58.11</span>   <span class="number">9.51</span>  <span class="number">96.71</span>    <span class="number">79</span>    <span class="number">0.177</span>     <span class="number">5</span>    <span class="number">0.495</span>    <span class="number">0.673</span></span><br></pre></td></tr></table></figure>
<p>The output of this example shows that a young generation collection occurred between the 3rd and 4th sample. The collection took 0.001 seconds and promoted objects from the eden space (E) to the old space (O), resulting in an increase of old space utilization from 9.49% to 9.51%. Before the collection, the survivor space was 12.44% utilized, but after this collection it is only 7.74% utilized.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>S0</td>
<td>Survivor space 0 utilization as a percentage of the space’s current capacity.</td>
</tr>
<tr>
<td>S1</td>
<td>Survivor space 1 utilization as a percentage of the space’s current capacity.</td>
</tr>
<tr>
<td>E</td>
<td>Eden space utilization as a percentage of the space’s current capacity.</td>
</tr>
<tr>
<td>O</td>
<td>Old space utilization as a percentage of the space’s current capacity.</td>
</tr>
<tr>
<td>P</td>
<td>Permanent space utilization as a percentage of the space’s current capacity.</td>
</tr>
<tr>
<td>YGC</td>
<td>Number of young generation GC events.</td>
</tr>
<tr>
<td>YGCT</td>
<td>Young generation garbage collection time.</td>
</tr>
</tbody>
</table>
<p>FGC    Number of full GC events.<br>FGCT    | Full garbage collection time.<br>GCT    | Total garbage collection time.</p>
<h3 id="gcnew"><a href="#gcnew" class="headerlink" title="-gcnew"></a>-gcnew</h3><pre><code>jstat -gcnew [outputOptions] pid [interval]
</code></pre><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ jstat -gcnew -h3 <span class="number">21891</span> <span class="number">250</span></span><br><span class="line"></span><br><span class="line">S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT</span><br><span class="line"></span><br><span class="line"> <span class="number">64.0</span>   <span class="number">64.0</span>    <span class="number">0.0</span>   <span class="number">31.7</span> <span class="number">31</span>  <span class="number">31</span>   <span class="number">32.0</span>    <span class="number">512.0</span>    <span class="number">178.6</span>    <span class="number">249</span>    <span class="number">0.203</span></span><br><span class="line"></span><br><span class="line"> <span class="number">64.0</span>   <span class="number">64.0</span>    <span class="number">0.0</span>   <span class="number">31.7</span> <span class="number">31</span>  <span class="number">31</span>   <span class="number">32.0</span>    <span class="number">512.0</span>    <span class="number">355.5</span>    <span class="number">249</span>    <span class="number">0.203</span></span><br><span class="line"></span><br><span class="line"> <span class="number">64.0</span>   <span class="number">64.0</span>   <span class="number">35.4</span>    <span class="number">0.0</span>  <span class="number">2</span>  <span class="number">31</span>   <span class="number">32.0</span>    <span class="number">512.0</span>     <span class="number">21.9</span>    <span class="number">250</span>    <span class="number">0.204</span></span><br><span class="line"></span><br><span class="line">S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT</span><br><span class="line"></span><br><span class="line"> <span class="number">64.0</span>   <span class="number">64.0</span>   <span class="number">35.4</span>    <span class="number">0.0</span>  <span class="number">2</span>  <span class="number">31</span>   <span class="number">32.0</span>    <span class="number">512.0</span>    <span class="number">245.9</span>    <span class="number">250</span>    <span class="number">0.204</span></span><br><span class="line"></span><br><span class="line"> <span class="number">64.0</span>   <span class="number">64.0</span>   <span class="number">35.4</span>    <span class="number">0.0</span>  <span class="number">2</span>  <span class="number">31</span>   <span class="number">32.0</span>    <span class="number">512.0</span>    <span class="number">421.1</span>    <span class="number">250</span>    <span class="number">0.204</span></span><br><span class="line"></span><br><span class="line"> <span class="number">64.0</span>   <span class="number">64.0</span>    <span class="number">0.0</span>   <span class="number">19.0</span> <span class="number">31</span>  <span class="number">31</span>   <span class="number">32.0</span>    <span class="number">512.0</span>     <span class="number">84.4</span>    <span class="number">251</span>    <span class="number">0.204</span></span><br><span class="line"></span><br><span class="line">S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT</span><br><span class="line"></span><br><span class="line"> <span class="number">64.0</span>   <span class="number">64.0</span>    <span class="number">0.0</span>   <span class="number">19.0</span> <span class="number">31</span>  <span class="number">31</span>   <span class="number">32.0</span>    <span class="number">512.0</span>    <span class="number">306.7</span>    <span class="number">251</span>    <span class="number">0.204</span></span><br></pre></td></tr></table></figure>
<p>In addition to showing the repeating header string, this example shows that between the 2nd and 3rd samples, a young GC occurred. Its duration was 0.001 seconds. The collection found enough live data that the survivor space 0 utilization (S0U) would would have exceeded the desired survivor Size (DSS). As a result, objects were promoted to the old generation (not visible in this output), and the tenuring threshold (TT) was lowered from 31 to 2.</p>
<p>Another collection occurs between the 5th and 6th samples. This collection found very few survivors and returned the tenuring threshold to 31.</p>
<table>
<thead>
<tr>
<th>Column</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>S0C</td>
<td>Current survivor space 0 capacity (KB).</td>
</tr>
<tr>
<td>S1C</td>
<td>Current survivor space 1 capacity (KB).</td>
</tr>
<tr>
<td>S0U</td>
<td>Survivor space 0 utilization(利用，使用) (KB).</td>
</tr>
<tr>
<td>S1U</td>
<td>Survivor space 1 utilization (KB).</td>
</tr>
<tr>
<td>TT</td>
<td>Tenuring threshold(门槛).</td>
</tr>
<tr>
<td>MTT</td>
<td>Maximum tenuring threshold.</td>
</tr>
<tr>
<td>DSS</td>
<td>Desired(期望) survivor size (KB).</td>
</tr>
<tr>
<td>EC</td>
<td>Current eden space capacity (KB).</td>
</tr>
<tr>
<td>EU</td>
<td>Eden space utilization (KB).</td>
</tr>
<tr>
<td>YGC</td>
<td>Number of young generation GC events.</td>
</tr>
<tr>
<td>YGCT</td>
<td>Young generation garbage collection time.</td>
</tr>
</tbody>
</table>
<blockquote>
<p>什么情况下新生代对象会晋升到老年代？</p>
<ol>
<li>当对象大小超过了PretenureSizeThreshold设置的对象大小阀值时，对象直接在老年代分配空间。</li>
<li>当age从1开始的对象大小累计超过了Survivor区域的1/2(TargetSurvivorRatio所定义)时，会计算一个Thenuring Threshold，超过这个年龄的新生代对象会进入到老年代，即使这时候新生代还有很多的空间。注意MaxTenuringThreshold只是设置了最大的Thenuring Threshold，不是说只有大于Max Tenuring Threshold才会进入到老年代，而是只要超过了计算出来的Tenuring Threshold就会进入老年代，MaxTenuringThreshold规定了Tenuring Threshold的最大值而已。Tenuring Threshold这个值在每一轮GC后都会动态计算，它与TargetSurvivorRatio以及Survivor区的大小有关系，TargetSurivivor默认是50即Survivor的1/2, 会计算出一个Desired Survivor Size，当age从1开始的对象大小累计超过了这个Desired Survivor Size，那么这个age就是Tenuring Threshold的值。</li>
</ol>
</blockquote>
<h1 id="jmap"><a href="#jmap" class="headerlink" title="jmap"></a>jmap</h1><p>JVM Memory Map命令用于生成heap dump文件，如果不使用这个命令，还可以使用-XX:+HeapDumpOnOutOfMemoryError参数来让虚拟机出现OOM的时候自动生成dump文件。 jmap不仅能生成dump文件，还可以查询finalize执行队列、Java堆和永久代的详细信息，如当前使用率、当前使用的是哪种收集器等。</p>
<p>jmap命令官方文档：<a href="https://docs.oracle.com/javase/6/docs/technotes/tools/share/jmap.html" target="_blank" rel="noopener">https://docs.oracle.com/javase/6/docs/technotes/tools/share/jmap.html</a></p>
<h2 id="用法-3"><a href="#用法-3" class="headerlink" title="用法"></a>用法</h2><pre><code>jmap [option] pid
</code></pre><blockquote>
<p>具体说明可以使用 <code>jmap -help</code> 查看</p>
</blockquote>
<h2 id="选项说明"><a href="#选项说明" class="headerlink" title="选项说明"></a>选项说明</h2><blockquote>
<p><code>-dump:[live,]format=b,file=&lt;filename&gt;</code> : Dumps the Java heap in hprof binary format to filename. The live suboption is optional. If specified, only the live objects in the heap are dumped. To browse the heap dump, you can use jhat (Java Heap Analysis Tool) to read the generated file. <br></p>
<p><code>-finalizerinfo</code> : 显示在F-Queue队列等待Finalizer线程执行finalizer方法的对象 <br></p>
<p><code>-heap</code> : 显示Java堆详细信息 <br></p>
<p><code>-histo[:live]</code> : 显示堆中对象的统计信息，如果指定了<code>live</code>子选项，则只计数活动对象。 <br></p>
<p><code>-permstat</code> : to print permanent generation statistics <br></p>
<p><code>-F</code> : 当-dump没有响应时，强制生成dump快照 <br></p>
<p><code>-J&lt;flag&gt;</code> :<br>Passes <flag> to the Java virtual machine on which jmap is run</flag></p>
</blockquote>
<h2 id="示例-2"><a href="#示例-2" class="headerlink" title="示例"></a>示例</h2><h3 id="heap"><a href="#heap" class="headerlink" title="heap"></a>heap</h3><p>先用<code>jps</code>找出相关Java线程的pid，然后使用此命令。</p>
<pre><code>$ jmap -heap pid
</code></pre><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;jmap -heap <span class="number">13812</span></span><br><span class="line">Attaching to process ID <span class="number">13812</span>, please wait...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is <span class="number">24.79</span>-b02</span><br><span class="line"></span><br><span class="line">using thread-local object allocation.</span><br><span class="line">Parallel GC <span class="keyword">with</span> <span class="number">8</span> thread(s) //GC 方式</span><br><span class="line"></span><br><span class="line">Heap Configuration: //堆内存初始化配置</span><br><span class="line">   <span class="attr">MinHeapFreeRatio</span>         = <span class="number">0</span>//对应jvm启动参数-XX:MinHeapFreeRatio设置JVM堆最小空闲比率(default <span class="number">40</span>)</span><br><span class="line">   <span class="attr">MaxHeapFreeRatio</span>         = <span class="number">100</span>//对应jvm启动参数 -XX:MaxHeapFreeRatio设置JVM堆最大空闲比率(default <span class="number">70</span>)</span><br><span class="line">   <span class="attr">MaxHeapSize</span>              = <span class="number">1040187392</span> (<span class="number">992.0</span>MB) //对应jvm启动参数-XX:<span class="attr">MaxHeapSize=设置JVM堆的最大大小</span></span><br><span class="line">   <span class="attr">NewSize</span>                  = <span class="number">21495808</span> (<span class="number">20.5</span>MB)//对应jvm启动参数-XX:<span class="attr">NewSize=设置JVM堆的‘新生代’的默认大小</span></span><br><span class="line">   <span class="attr">MaxNewSize</span>               = <span class="number">346554368</span> (<span class="number">330.5</span>MB)//对应jvm启动参数-XX:<span class="attr">MaxNewSize=设置JVM堆的‘新生代’的最大大小</span></span><br><span class="line">   <span class="attr">OldSize</span>                  = <span class="number">43515904</span> (<span class="number">41.5</span>MB)//对应jvm启动参数-XX:<span class="attr">OldSize=&lt;value&gt;:设置JVM堆的‘老生代’的大小</span></span><br><span class="line">   <span class="attr">NewRatio</span>                 = <span class="number">2</span>//对应jvm启动参数-XX:<span class="attr">NewRatio=:‘新生代’和‘老生代’的大小比率</span></span><br><span class="line">   <span class="attr">SurvivorRatio</span>            = <span class="number">8</span>//对应jvm启动参数-XX:<span class="attr">SurvivorRatio=设置年轻代中Eden区与Survivor区的大小比值</span> </span><br><span class="line"></span><br><span class="line">   <span class="attr">PermSize</span>         = <span class="number">21757952</span> (<span class="number">20.75</span>MB)</span><br><span class="line">   <span class="attr">MaxPermSize</span>      = <span class="number">85983232</span> (<span class="number">82.0</span>MB)</span><br><span class="line">   <span class="attr">G1HeapRegionSize</span> = <span class="number">0</span> (<span class="number">0.0</span>MB)</span><br><span class="line"></span><br><span class="line">Heap Usage: //堆内存使用情况</span><br><span class="line">PS Young Generation</span><br><span class="line">Eden Space:</span><br><span class="line">   <span class="attr">capacity</span> = <span class="number">5242880</span> (<span class="number">5.0</span>MB)</span><br><span class="line">   <span class="attr">used</span>     = <span class="number">3618584</span> (<span class="number">3.4509506225585938</span>MB)</span><br><span class="line">   <span class="attr">free</span>     = <span class="number">1624296</span> (<span class="number">1.5490493774414062</span>MB)</span><br><span class="line">   <span class="number">69.01901245117188</span>% used</span><br><span class="line">From Space:</span><br><span class="line">   <span class="attr">capacity</span> = <span class="number">524288</span> (<span class="number">0.5</span>MB)</span><br><span class="line">   <span class="attr">used</span>     = <span class="number">229376</span> (<span class="number">0.21875</span>MB)</span><br><span class="line">   <span class="attr">free</span>     = <span class="number">294912</span> (<span class="number">0.28125</span>MB)</span><br><span class="line">   <span class="number">43.75</span>% used</span><br><span class="line">To Space:</span><br><span class="line">   <span class="attr">capacity</span> = <span class="number">524288</span> (<span class="number">0.5</span>MB)</span><br><span class="line">   <span class="attr">used</span>     = <span class="number">0</span> (<span class="number">0.0</span>MB)</span><br><span class="line">   <span class="attr">free</span>     = <span class="number">524288</span> (<span class="number">0.5</span>MB)</span><br><span class="line">   <span class="number">0.0</span>% used</span><br><span class="line">PS Old Generation</span><br><span class="line">   <span class="attr">capacity</span> = <span class="number">7340032</span> (<span class="number">7.0</span>MB)</span><br><span class="line">   <span class="attr">used</span>     = <span class="number">688224</span> (<span class="number">0.656341552734375</span>MB)</span><br><span class="line">   <span class="attr">free</span>     = <span class="number">6651808</span> (<span class="number">6.343658447265625</span>MB)</span><br><span class="line">   <span class="number">9.376307896205358</span>% used</span><br><span class="line">PS Perm Generation</span><br><span class="line">   <span class="attr">capacity</span> = <span class="number">22020096</span> (<span class="number">21.0</span>MB)</span><br><span class="line">   <span class="attr">used</span>     = <span class="number">2633520</span> (<span class="number">2.5115203857421875</span>MB)</span><br><span class="line">   <span class="attr">free</span>     = <span class="number">19386576</span> (<span class="number">18.488479614257812</span>MB)</span><br><span class="line">   <span class="number">11.959620884486608</span>% used</span><br><span class="line"></span><br><span class="line"><span class="number">1522</span> interned Strings occupying <span class="number">140184</span> bytes.</span><br></pre></td></tr></table></figure>
<h3 id="histo-live"><a href="#histo-live" class="headerlink" title="histo[:live]"></a>histo[:live]</h3><p>打印堆的对象统计，包括对象数、内存大小等等。jmap -histo:live 这个命令执行，JVM会先触发Full GC，然后再统计信息。带<code>live</code> 子选项的只会统计活对象。</p>
<pre><code>$ jmap -histo[:live] pid
</code></pre><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt; jmap -histo:live <span class="number">13812</span> | more</span><br><span class="line"></span><br><span class="line"> num     <span class="comment">#instances         #bytes  class name</span></span><br><span class="line">----------------------------------------------</span><br><span class="line">   <span class="number">1</span>:          <span class="number">5833</span>         <span class="number">752160</span>  <span class="variable">&lt;methodKlass&gt;</span></span><br><span class="line">   <span class="number">2</span>:          <span class="number">5833</span>         <span class="number">676232</span>  <span class="variable">&lt;constMethodKlass&gt;</span></span><br><span class="line">   <span class="number">3</span>:           <span class="number">389</span>         <span class="number">467400</span>  <span class="variable">&lt;constantPoolKlass&gt;</span></span><br><span class="line">   <span class="number">4</span>:          <span class="number">1924</span>         <span class="number">288568</span>  [C</span><br><span class="line">   <span class="number">5</span>:           <span class="number">352</span>         <span class="number">280928</span>  <span class="variable">&lt;constantPoolCacheKlass&gt;</span></span><br><span class="line">   <span class="number">6</span>:           <span class="number">389</span>         <span class="number">266520</span>  <span class="variable">&lt;instanceKlassKlass&gt;</span></span><br><span class="line">   <span class="number">7</span>:           <span class="number">545</span>          <span class="number">91448</span>  [B</span><br><span class="line">   <span class="number">8</span>:           <span class="number">451</span>          <span class="number">44296</span>  java.lang.Class</span><br><span class="line">   <span class="number">9</span>:          <span class="number">1775</span>          <span class="number">42600</span>  java.lang.String</span><br><span class="line">  <span class="number">10</span>:           <span class="number">636</span>          <span class="number">42400</span>  [[I</span><br><span class="line">  <span class="number">11</span>:           <span class="number">593</span>          <span class="number">36448</span>  [S</span><br><span class="line">  <span class="number">12</span>:           <span class="number">785</span>          <span class="number">31400</span>  java.util.TreeMap<span class="variable">$Entry</span></span><br><span class="line">  <span class="number">13</span>:            <span class="number">45</span>          <span class="number">24480</span>  <span class="variable">&lt;objArrayKlassKlass&gt;</span></span><br><span class="line">  <span class="number">14</span>:            <span class="number">39</span>          <span class="number">15752</span>  <span class="variable">&lt;methodDataKlass&gt;</span></span><br><span class="line">  <span class="number">15</span>:           <span class="number">314</span>          <span class="number">13352</span>  [Ljava.lang.Object;</span><br><span class="line">  <span class="number">16</span>:           <span class="number">187</span>           <span class="number">7640</span>  [Ljava.lang.String;</span><br><span class="line">  <span class="number">17</span>:             <span class="number">8</span>           <span class="number">4352</span>  <span class="variable">&lt;typeArrayKlassKlass&gt;</span></span><br><span class="line">  <span class="number">18</span>:            <span class="number">93</span>           <span class="number">3720</span>  java.lang.ref.SoftReference</span><br><span class="line">  <span class="number">19</span>:           <span class="number">114</span>           <span class="number">3648</span>  java.util.Hashtable<span class="variable">$Entry</span></span><br><span class="line">  <span class="number">20</span>:            <span class="number">37</span>           <span class="number">2368</span>  java.net.URL</span><br><span class="line">  <span class="number">21</span>:            <span class="number">11</span>           <span class="number">2288</span>  <span class="variable">&lt;klassKlass&gt;</span></span><br><span class="line">  <span class="number">22</span>:            <span class="number">38</span>           <span class="number">1824</span>  sun.util.locale.LocaleObjectCache<span class="variable">$CacheEntry</span></span><br><span class="line">  <span class="number">23</span>:            <span class="number">55</span>           <span class="number">1760</span>  java.util.concurrent.ConcurrentHashMap<span class="variable">$HashEntry</span></span><br><span class="line">  <span class="number">24</span>:            <span class="number">44</span>           <span class="number">1760</span>  java.util.concurrent.ConcurrentHashMap<span class="variable">$Segment</span></span><br><span class="line">  <span class="number">25</span>:            <span class="number">38</span>           <span class="number">1520</span>  java.util.LinkedHashMap<span class="variable">$Entry</span></span><br><span class="line">  <span class="number">26</span>:            <span class="number">44</span>           <span class="number">1408</span>  java.util.concurrent.locks.ReentrantLock<span class="variable">$NonfairSync</span></span><br><span class="line">  <span class="number">27</span>:            <span class="number">44</span>           <span class="number">1184</span>  [Ljava.util.concurrent.ConcurrentHashMap<span class="variable">$HashEntry</span>;</span><br><span class="line">  <span class="number">28</span>:            <span class="number">13</span>           <span class="number">1168</span>  [Ljava.util.HashMap<span class="variable">$Entry</span>;</span><br><span class="line">  <span class="number">29</span>:             <span class="number">3</span>           <span class="number">1112</span>  [I</span><br><span class="line">  <span class="number">30</span>:             <span class="number">1</span>           <span class="number">1040</span>  [[C</span><br><span class="line">  <span class="number">31</span>:             <span class="number">6</span>            <span class="number">992</span>  [Ljava.util.Hashtable<span class="variable">$Entry</span>;</span><br><span class="line">  <span class="number">32</span>:            <span class="number">36</span>            <span class="number">864</span>  java.io.ExpiringCache<span class="variable">$Entry</span></span><br><span class="line">  <span class="number">33</span>:            <span class="number">26</span>            <span class="number">832</span>  java.util.HashMap<span class="variable">$Entry</span></span><br><span class="line">  <span class="number">34</span>:            <span class="number">17</span>            <span class="number">816</span>  java.util.HashMap</span><br><span class="line">  <span class="number">35</span>:            <span class="number">19</span>            <span class="number">760</span>  sun.util.locale.BaseLocale<span class="variable">$Key</span></span><br><span class="line">  <span class="number">36</span>:            <span class="number">19</span>            <span class="number">760</span>  java.io.ObjectStreamField</span><br><span class="line">  <span class="number">37</span>:            <span class="number">10</span>            <span class="number">720</span>  java.lang.reflect.Constructor</span><br><span class="line">  <span class="number">38</span>:             <span class="number">8</span>            <span class="number">640</span>  [Ljava.util.concurrent.ConcurrentHashMap<span class="variable">$Segment</span>;</span><br><span class="line">  <span class="number">39</span>:             <span class="number">6</span>            <span class="number">624</span>  java.lang.Thread</span><br><span class="line">  <span class="number">40</span>:            <span class="number">19</span>            <span class="number">608</span>  sun.util.locale.BaseLocale</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>
<blockquote>
<p>jmap -histo:live 24971 | java.lang.String 查询类名包含java.lang.String的信息</p>
<p>jmap -histo:live 24971 | grep java.lang.String &gt; histo.txt 保存信息到histo.txt文件</p>
</blockquote>
<h3 id="permstat"><a href="#permstat" class="headerlink" title="permstat"></a>permstat</h3><p>打印Java堆内存的永久区的类加载器的智能统计信息。对于每个类加载器而言，它的名称、活跃度、地址、父类加载器、它所加载的类的数量和大小都会被打印。此外，包含的字符串数量和大小也会被打印。</p>
<p>使用方法：</p>
<pre><code>$ jmap -permstat pid
</code></pre><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;jmap -permstat 13812</span><br><span class="line">Attaching <span class="keyword">to</span> process ID 13812, please wait<span class="built_in">..</span>.</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 24.79-b02</span><br><span class="line">finding class loader instances <span class="built_in">..</span>done.</span><br><span class="line">computing per loader stat <span class="built_in">..</span>done.</span><br><span class="line">please wait<span class="built_in">..</span> computing liveness<span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span><span class="built_in">..</span>done.</span><br><span class="line">class_loader    classes bytes   parent_loader   alive?  type</span><br><span class="line"></span><br><span class="line">&lt;bootstrap&gt;     388     2581896   <span class="literal">null</span>          live    &lt;internal&gt;</span><br><span class="line">0x00000000fec39b28      8       102232  0x00000000fec3a1c8      live    sun/misc/Launcher<span class="variable">$AppClassLoader</span>@0x00000000f9c3b030</span><br><span class="line">0x00000000fec3a1c8      0       0         <span class="literal">null</span>          live    sun/misc/Launcher<span class="variable">$ExtClassLoader</span>@0x00000000f9be6128</span><br><span class="line"></span><br><span class="line">total = 3       396     2684128     N/A         <span class="attribute">alive</span>=3, <span class="attribute">dead</span>=0     N/A</span><br></pre></td></tr></table></figure>
<h3 id="dump"><a href="#dump" class="headerlink" title="dump"></a>dump</h3><p>dump堆到文件,format指定输出格式，live指明是活着的对象,file指定文件名</p>
<pre><code>$ jmap -dump[:live],format=b,file=[filename].hprof pid    
</code></pre><p>示例：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\tomgs&gt;jmap -dump:live,format=<span class="selector-tag">b</span>,file=D:/dump<span class="selector-class">.hprof</span> <span class="number">13812</span></span><br><span class="line">Dumping heap to D:\dump<span class="selector-class">.hprof</span> ...</span><br><span class="line">Heap dump file created</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>使用jmap来dump内存时，系统会被暂停，它会先做一次Full GC再dump内存。</p>
</blockquote>

      
    </div>
    <footer>
      
        
        
        <div class="alignright">
          <a href="/2018/03/15/JVM工具/#comment" class="comment-link">Comments</a>
        </div>
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



 
<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">下一页</a>
  
  <div class="clearfix"></div>
</nav>
</div></div>
      <aside id="sidebar" class="alignright">
  
<div class="widget tag">
  <h3 class="title" id="categories">分类</h3>
     <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/java/JVM/">JVM</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/集合框架/">集合框架</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/spring/">spring</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/工具/">工具</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/工具/压测/">压测</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/MySQL/">MySQL</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/编程/hexo教程/">hexo教程</a><span class="category-list-count">1</span></li></ul></li></ul> 
</div>
 


  <div class="widget tag">
  <h3 class="title">微信公众账号</h3>
    <ul class="entry">
      <img src="/img/default/qrcode.jpg" alt="欢迎关注个人公众账号" style= "width: 100%">
    </ul>
</div>

  


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/JVM/">JVM</a><small>1</small></li>
  
    <li><a href="/tags/MySQL/">MySQL</a><small>1</small></li>
  
    <li><a href="/tags/ab压测工具/">ab压测工具</a><small>1</small></li>
  
    <li><a href="/tags/hexo/">hexo</a><small>1</small></li>
  
    <li><a href="/tags/java/">java</a><small>2</small></li>
  
    <li><a href="/tags/spring/">spring</a><small>2</small></li>
  
    <li><a href="/tags/集合框架/">集合框架</a><small>1</small></li>
  
  </ul>
</div>



  
  <div class="widget tag">
    <h3 class="title">归档</h3>
	<ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/">公元 2018 年</a><span class="archive-list-count">8</span></li></ul>
  </div>

</aside>
      <div class="clearfix"></div>
    </div>
  
  <footer id="footer"><div class="footer-content inner">
  <div class="alignleft">
  
    &copy; 2018 tomgs
    
  </div>
  <!-- <div class="alignright">
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, Theme
    <a href="https://github.com/pengloo53/Hexo-theme-light_cn">light_cn</a>, 
    <p>Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a></p>
  </div> -->
  
  <div class="visit">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
  </div>
  
  <div class="clearfix"></div>
</div>
</footer>
  <script src="http://libs.baidu.com/jquery/2.1.1/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>

<!-- calendar widget -->


<!-- 『不蒜子』计数服务 -->
<script async src="http://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- 百度统计 -->
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c4ec2c7a97d8bada21b93c3a78422b39";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>


<!-- wumii关联推荐 -->
<script type="text/javascript" src="http://widget.wumii.cn/ext/relatedItemsWidget"></script>

<!-- 百度推荐 -->

	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "//hm.baidu.com/hm.js?"c4ec2c7a97d8bada21b93c3a78422b39;
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>



<!-- 返回顶部 -->
<div id="toTop">
	<a href="#">▲</a>
	<a href="#footer">▼</a>
</div>

<!-- 站内搜索-Swiftype -->
<!-- <script type="text/javascript">
  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
  
  _st('install','sC-iNFrvTTNtiXEVNwo1','2.0.0');
</script> -->

<!-- fancybox -->

<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


</body>
</html>
<!-- 
<a href="https://github.com/tincopper" target="_blank"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_white_ffffff.png" alt="Fork me on GitHub"></a>
-->